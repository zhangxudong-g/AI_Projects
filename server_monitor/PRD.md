# 服务器监控系统增强功能 PRD

## 1. 项目概述

### 1.1 项目名称
服务器监控系统增强功能

### 1.2 项目背景
在现有的服务器监控系统基础上，增加Docker容器监控和Web版CLI终端功能，提升运维效率和用户体验。

### 1.3 项目目标
- 实现Docker容器和镜像的实时监控
- 提供Web版CLI终端，支持远程命令执行
- 优化用户界面和交互体验

## 2. 功能需求

### 2.1 Docker监控功能

#### 2.1.1 功能描述
在监控面板中增加Docker状态查看功能，可查看所有配置服务器上的Docker容器和镜像信息。

#### 2.1.2 功能特性
- 点击"Docker Status"按钮打开Docker状态模态框
- 自动获取所有配置服务器的Docker信息
- 以表格形式展示运行中的容器信息（ID、名称、状态、端口）
- 以表格形式展示Docker镜像信息（仓库、标签、ID、大小）
- 支持多服务器同时显示
- 实时加载和显示数据

#### 2.1.3 技术实现
- 后端API：`/api/docker/containers/{server_name}` 和 `/api/docker/images/{server_name}`
- 前端：AJAX请求获取数据，动态生成表格
- SSH执行：`docker ps` 和 `docker images` 命令

### 2.2 Web版CLI终端功能

#### 2.2.1 功能描述
提供Web界面的命令行终端，允许用户直接在浏览器中执行远程服务器命令。

#### 2.2.2 功能特性
- 点击"CLI"按钮打开终端模态框
- 服务器选择下拉菜单，显示所有配置的服务器
- 终端输出区域（黑色背景，绿色文字，类似传统终端）
- 命令输入框，支持回车执行
- "Execute with sudo"复选框，支持sudo权限执行
- 清屏按钮
- 自动显示当前目录（打开终端时自动执行pwd命令）
- 实时命令执行和输出显示
- WebSocket支持实时通信

#### 2.2.3 技术实现
- 后端WebSocket：`/ws/cli/{server_name}` 实时通信
- 前端WebSocket客户端连接
- SSH交互式命令执行
- 支持sudo命令执行（需要配置sudo_password）

## 3. 配置要求

### 3.1 服务器配置
在config.yaml中需要为每个服务器添加sudo_password字段：

```yaml
servers:
  - name: "Server - ps"
    host: "taburiss.wang"
    port: 22
    username: "ps"
    password: "Swiftechie.com0318#"
    sudo_password: "your_sudo_password_here"  # 新增字段
```

### 3.2 权限要求
- SSH访问权限
- Docker命令执行权限（对于Docker功能）
- sudo权限（对于CLI的sudo功能）

## 4. 用户界面

### 4.1 主界面
- 在顶部导航栏增加"Docker Status"和"CLI"按钮
- 按钮使用Font Awesome图标区分功能

### 4.2 Docker模态框
- 大型模态框（modal-xl）
- 分别显示各服务器的容器和镜像信息
- 表格形式展示，支持响应式布局

### 4.3 CLI模态框
- 服务器选择下拉菜单
- 终端输出区域（类似传统终端样式）
- 命令输入框
- sudo执行选项
- 清屏按钮

## 5. 技术架构

### 5.1 后端技术栈
- FastAPI：Web框架
- asyncssh：SSH客户端
- WebSockets：实时通信
- PyYAML：配置文件解析

### 5.2 前端技术栈
- Bootstrap 5：CSS框架
- jQuery：DOM操作
- WebSockets：实时通信
- Chart.js：图表展示（原有功能）

### 5.3 通信协议
- HTTP/HTTPS：API请求
- WebSockets：实时命令执行
- SSH：远程命令执行

## 6. 安全考虑

### 6.1 认证授权
- 保留原有的认证机制
- 命令执行权限控制

### 6.2 数据安全
- 敏感信息（如密码）在配置文件中加密存储
- SSH连接使用安全协议
- 命令执行权限控制

### 6.3 输入验证
- 命令输入验证和过滤
- 防止命令注入攻击

## 7. 性能要求

### 7.1 响应时间
- Docker信息加载：< 3秒
- CLI命令执行：< 1秒
- WebSocket连接建立：< 2秒

### 7.2 并发支持
- 支持多用户同时使用
- 支持多服务器并发监控

## 8. 兼容性

### 8.1 浏览器兼容性
- Chrome/Firefox/Safari/Edge 最新版
- 移动端浏览器支持

### 8.2 服务器兼容性
- Linux服务器（Ubuntu, CentOS, Debian等）
- 支持Docker的服务器环境

## 9. 测试要求

### 9.1 功能测试
- Docker功能测试：验证容器和镜像信息获取
- CLI功能测试：验证命令执行和输出显示
- 多服务器支持测试

### 9.2 集成测试
- 与现有监控功能集成测试
- WebSocket连接稳定性测试

### 9.3 安全测试
- 权限验证测试
- 命令注入防护测试

## 10. 部署要求

### 10.1 环境要求
- Python 3.8+
- FastAPI兼容环境
- SSH访问权限

### 10.2 部署步骤
1. 更新代码到服务器
2. 安装新依赖（如有）
3. 更新配置文件，添加sudo_password字段
4. 重启服务

## 11. 维护和监控

### 11.1 日志记录
- 命令执行日志
- 连接状态日志
- 错误日志

### 11.2 监控指标
- WebSocket连接数
- 命令执行成功率
- 响应时间统计

## 12. 未来扩展

### 12.1 功能扩展
- 命令历史记录
- 命令收藏功能
- 批量命令执行
- 文件传输功能

### 12.2 性能优化
- 命令执行缓存
- 连接池优化
- 输出压缩传输