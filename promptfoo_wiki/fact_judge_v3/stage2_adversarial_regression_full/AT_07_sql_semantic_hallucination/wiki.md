This logic guarantees transactional isolation
and prevents concurrent update anomalies.