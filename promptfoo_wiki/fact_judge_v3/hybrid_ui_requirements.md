# Engineering Judge v3 混合模型需求文档

## 1. 项目概述

### 1.1 项目背景
Engineering Judge v3 是一个基于 promptfoo 框架构建的工程导向 Wiki 质量评估系统，专门用于评估代码解释性文档的工程价值和风险。随着项目发展，需要在保持现有命令行功能的基础上，增加 Web UI 以提升用户体验和协作能力。

### 1.2 项目目标
- 保持现有命令行界面的核心功能
- 提供直观的 Web UI 以增强用户体验
- 实现命令行与 Web UI 的无缝集成
- 支持实时监控、可视化报告和协作功能

## 2. 系统架构

### 2.1 混合架构设计
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Web UI        │    │   API Server    │    │  CLI Engine     │
│  (React/FastAPI)│ ←→ │  (FastAPI)      │ ←→ │  (Existing)     │
│                 │    │                 │    │                 │
│ - Dashboard     │    │ - REST API      │    │ - run_single_   │
│ - Case Manager  │    │ - WebSocket     │    │   case_pipeline │
│ - Execution     │    │ - Job Queue     │    │ - run_multi_    │
│   Monitor       │    │ - Authentication│    │   cases_unified │
│ - Reports       │    │ - Data Storage  │    │ - utils         │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 组件说明
- **Web UI**: 提供图形化界面，支持所有管理功能
- **API Server**: 提供 RESTful API 和 WebSocket 服务
- **CLI Engine**: 现有的命令行执行引擎

## 3. 功能需求

### 3.1 Web UI 功能

#### 3.1.1 仪表盘 (Dashboard)
- **功能**: 显示系统概览信息
- **内容**:
  - 总执行次数统计
  - 成功率趋势图
  - 平均得分分布
  - 最近执行状态
- **刷新频率**: 实时更新

#### 3.1.2 案例管理 (Case Management)
- **功能**: 管理测试案例配置
- **操作**:
  - 创建/编辑/删除案例
  - 批量导入/导出案例
  - 案例模板管理
  - YAML 配置在线编辑器
- **验证**: 语法验证和配置有效性检查

#### 3.1.3 执行控制 (Execution Control)
- **功能**: 控制测试执行过程
- **操作**:
  - 手动执行单个或批量案例
  - 查看执行队列
  - 实时监控执行进度
  - 中断/暂停执行
  - 调度执行（定时/周期）
- **状态显示**: 执行状态、进度条、日志输出

#### 3.1.4 报告系统 (Reporting)
- **功能**: 生成和展示执行报告
- **内容**:
  - 详细结果表格
  - 图表可视化（柱状图、折线图、饼图）
  - 历史对比分析
  - 导出功能（PDF、Excel、JSON）
- **过滤**: 按时间、得分、状态等过滤

#### 3.1.5 用户管理 (User Management)
- **功能**: 多用户支持和权限管理
- **操作**:
  - 用户注册/登录
  - 角色权限分配
  - 个人配置设置
  - 操作历史记录

### 3.2 API 功能

#### 3.2.1 REST API
- **案例管理**: CRUD 操作
- **执行管理**: 启动、停止、查询执行状态
- **报告管理**: 获取、生成、导出报告
- **用户管理**: 认证、授权、用户信息

#### 3.2.2 WebSocket API
- **实时更新**: 执行进度、日志输出
- **事件通知**: 执行完成、错误发生
- **状态同步**: 多客户端状态同步

### 3.3 后端服务

#### 3.3.1 任务队列
- **功能**: 管理执行任务
- **实现**: 使用 Celery 或类似任务队列
- **特性**: 优先级、重试、失败处理

#### 3.3.2 数据存储
- **数据库**: PostgreSQL 或 SQLite
- **存储内容**: 案例配置、执行结果、用户数据
- **备份**: 自动备份和恢复机制

## 4. 非功能性需求

### 4.1 性能要求
- **响应时间**: 页面加载 < 2秒，API响应 < 500ms
- **并发支持**: 支持至少 50 个并发用户
- **大数据处理**: 支持万级案例的批量处理

### 4.2 可靠性要求
- **可用性**: 99.5% 系统可用性
- **容错性**: 单个任务失败不影响整体系统
- **恢复能力**: 系统崩溃后能快速恢复

### 4.3 安全性要求
- **认证**: JWT 或 OAuth2 认证
- **授权**: 基于角色的访问控制
- **数据保护**: 敏感数据加密存储

### 4.4 兼容性要求
- **浏览器**: 支持主流浏览器 (Chrome, Firefox, Safari, Edge)
- **移动端**: 响应式设计，支持移动设备
- **API兼容**: 保持与现有 CLI 的完全兼容

## 5. 技术选型

### 5.1 前端技术栈
- **框架**: React 18 + TypeScript
- **UI库**: Ant Design 或 Material-UI
- **状态管理**: Redux Toolkit 或 Zustand
- **图表库**: Chart.js 或 D3.js

### 5.2 后端技术栈
- **框架**: FastAPI (Python)
- **数据库**: PostgreSQL 或 SQLite
- **任务队列**: Celery + Redis
- **实时通信**: WebSocket + Socket.IO

### 5.3 部署技术
- **容器化**: Docker
- **编排**: Docker Compose 或 Kubernetes
- **反向代理**: Nginx
- **监控**: Prometheus + Grafana

## 6. 实施计划

### 6.1 第一阶段 (MVP - 2个月)
- [ ] API 服务器开发 (基础 CRUD)
- [ ] Web UI 基础框架搭建
- [ ] 案例管理功能
- [ ] 基础执行控制
- [ ] 简单报告展示

### 6.2 第二阶段 (增强 - 1个月)
- [ ] 实时监控功能
- [ ] 高级报告功能
- [ ] 用户认证系统
- [ ] 任务队列集成
- [ ] 数据可视化

### 6.3 第三阶段 (完善 - 1个月)
- [ ] 调度功能
- [ ] 高级权限管理
- [ ] 性能优化
- [ ] 移动端适配
- [ ] 文档完善

## 7. 风险评估

### 7.1 技术风险
- **复杂度增加**: 系统架构复杂度显著提升
- **维护成本**: 需要维护前后端两套代码
- **性能影响**: Web UI 可能影响系统性能

### 7.2 业务风险
- **用户迁移**: 现有用户需要适应新界面
- **功能冲突**: 新旧功能可能存在冲突
- **培训成本**: 用户需要学习新功能

### 7.3 缓解措施
- **渐进式开发**: 分阶段实现，降低风险
- **向后兼容**: 确保现有功能不受影响
- **充分测试**: 全面测试确保稳定性

## 8. 成功指标

### 8.1 技术指标
- 系统响应时间 < 500ms
- API 可用性 > 99.5%
- 并发用户支持 > 50

### 8.2 业务指标
- 用户满意度 > 85%
- 新功能使用率 > 70%
- 现有功能稳定性保持 100%

## 9. 预算估算

### 9.1 人力成本
- 前端开发: 2人月
- 后端开发: 3人月
- 测试: 1人月
- 项目管理: 0.5人月

### 9.2 基础设施成本
- 服务器租赁: $200/月
- CDN费用: $50/月
- 存储费用: $30/月

## 10. 结论

混合模型方案能够在保持现有命令行功能的基础上，通过 Web UI 提升用户体验和协作能力。该方案风险可控，收益明显，建议按计划实施。

---

**文档版本**: 1.0  
**创建日期**: 2026年2月9日  
**最后更新**: 2026年2月9日  
**作者**: System Assistant