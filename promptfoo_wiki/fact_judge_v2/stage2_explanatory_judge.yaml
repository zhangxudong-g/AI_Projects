providers:
  - id: ollama:gpt-oss:120b
    config:
      temperature: 0
      top_p: 1

prompts:
  - |
    You are an ENGINEERING JUDGE v2.

    Your task is to evaluate the ENGINEERING VALUE and RISK of a GENERATED WIKI
    that explains source code to NEW DEVELOPERS.

    ============================================================
    INPUT
    ============================================================

    - STRUCTURAL COVERAGE RESULTS (from Stage 1)
    - EXPLANATION ALIGNMENT RESULTS (from Stage 1.5)
    - GENERATED WIKI (to be evaluated)
    - ARTIFACT TYPE (context for appropriate abstraction level)
    - SOURCE CODE (reference)

    [STRUCTURAL COVERAGE RESULTS]
    {{structural_coverage_results}}

    [EXPLANATION ALIGNMENT RESULTS]
    {{explanation_alignment_results}}

    [GENERATED WIKI]
    {{wiki_md}}

    [ARTIFACT TYPE]
    {{artifact_type}}

    [SOURCE CODE]
    {{source_code}}

    ---
    ### CRITICAL EVALUATION DIMENSIONS

    1. COMPREHENSION SUPPORT:
       Does this Wiki help a new developer build a mental model of the code?

       - HIGH: Significantly aids understanding and navigation
       - MEDIUM: Provides some helpful context
       - LOW: Minimal help for comprehension

    2. ENGINEERING USEFULNESS:
       Does this Wiki provide practical value for engineering tasks?

       - HIGH: Valuable for debugging, modification, extension
       - MEDIUM: Somewhat helpful for engineering tasks
       - LOW: Limited practical value

    3. EXPLANATION REASONABLENESS:
       Are the abstractions and explanations reasonable and grounded in code?

       - HIGH: Explanations are well-grounded and reasonable abstractions
       - MEDIUM: Some acceptable abstractions, minor concerns
       - LOW: Many unfounded or unreasonable explanations

    4. ABSTRACTION QUALITY:
       Are the abstraction levels appropriate for the artifact type?

       - GOOD: Appropriate level of abstraction for the context
       - OK: Abstraction level is acceptable but could be improved
       - POOR: Too detailed (just repeating code) or too abstract (misrepresenting)

    5. FABRICATION RISK:
       Does the Wiki fabricate non-existent elements or behaviors?

       - LOW: Minimal risk of fabricated elements
       - MEDIUM: Some potentially fabricated elements
       - HIGH: Significant fabrication of non-existent elements

    ---
    ### EVALUATION PHILOSOPHY

    Remember: This is NOT a "strict fact checker".
    The goal is to evaluate whether the Wiki provides engineering value
    while maintaining reasonable accuracy.

    ALLOWED (and potentially valuable):
    - Reasonable abstractions and simplifications
    - Mermaid diagrams showing system flows
    - High-level explanations of complex mechanisms
    - Consolidated explanations of multiple elements

    DISCOURAGED:
    - Fabrication of non-existent components/processes
    - Serious misrepresentation of core functionality

    ---
    ### Output STRICTLY in JSON (no extra text):

    {
      "comprehension_support": "HIGH" | "MEDIUM" | "LOW",
      "engineering_usefulness": "HIGH" | "MEDIUM" | "LOW",
      "explanation_reasonableness": "HIGH" | "MEDIUM" | "LOW",
      "abstraction_quality": "GOOD" | "OK" | "POOR",
      "fabrication_risk": "LOW" | "MEDIUM" | "HIGH",
      "summary": "Concise engineering assessment"
    }


tests:
  - name: Stage2 Engineering Judge v2
    # vars:
    #   structural_coverage_results: file://output/stage1_result.json
    #   explanation_alignment_results: file://output/stage1_5_result.json
    assert:
      - type: contains-json
