{
  "evalId": "eval-UAp-2026-01-30T09:47:25",
  "results": {
    "version": 3,
    "timestamp": "2026-01-30T09:47:25.405Z",
    "prompts": [
      {
        "id": "d67930fce9ba3d75cb987b51ea04eff664d2aabc2c711e2e3421ecdfb4e654e6",
        "raw": "You are a FACT EXTRACTION ENGINE.\n\nYou are given:\n- SOURCE CODE (Java or SQL)\n- GENERATED WIKI (Markdown)\n\n--- SOURCE CODE ---\n{{source_code}}\n\n--- GENERATED WIKI ---\n{{wiki_md}}\n\nCRITICAL RULES:\n- Extract ONLY objective, verifiable facts\n- DO NOT evaluate quality\n- DO NOT assign scores\n- DO NOT summarize\n- DO NOT judge usefulness\n- DO NOT say good/bad/correct/incorrect\n- ONLY list concrete missing, mismatched, or hallucinated items\n\nREQUIRED OUTPUT (VALID JSON ONLY):\n\n{\n  \"coverage\": {\n    \"total_items\": <integer>,\n    \"covered_items\": <integer>,\n    \"missing\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what is missing>\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": <integer>,\n    \"mismatches\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what does not match the source>\"\n      }\n    ]\n  },\n  \"hallucination\": [\n    {\n      \"position\": <integer>,\n      \"content\": \"<invented object or behavior>\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<important concept not explained>\"\n      }\n    ]\n  }\n}\n",
        "label": "You are a FACT EXTRACTION ENGINE.\n\nYou are given:\n- SOURCE CODE (Java or SQL)\n- GENERATED WIKI (Markdown)\n\n--- SOURCE CODE ---\n{{source_code}}\n\n--- GENERATED WIKI ---\n{{wiki_md}}\n\nCRITICAL RULES:\n- Extract ONLY objective, verifiable facts\n- DO NOT evaluate quality\n- DO NOT assign scores\n- DO NOT summarize\n- DO NOT judge usefulness\n- DO NOT say good/bad/correct/incorrect\n- ONLY list concrete missing, mismatched, or hallucinated items\n\nREQUIRED OUTPUT (VALID JSON ONLY):\n\n{\n  \"coverage\": {\n    \"total_items\": <integer>,\n    \"covered_items\": <integer>,\n    \"missing\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what is missing>\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": <integer>,\n    \"mismatches\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what does not match the source>\"\n      }\n    ]\n  },\n  \"hallucination\": [\n    {\n      \"position\": <integer>,\n      \"content\": \"<invented object or behavior>\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<important concept not explained>\"\n      }\n    ]\n  }\n}\n",
        "provider": "ollama:gpt-oss:120b",
        "metrics": {
          "score": 1,
          "testPassCount": 1,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 0,
          "assertFailCount": 0,
          "totalLatencyMs": 25951,
          "tokenUsage": {
            "prompt": 28961,
            "completion": 1702,
            "cached": 0,
            "total": 30663,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      }
    ],
    "results": [
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "No assertions",
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          }
        },
        "id": "445eafcd-0639-4e0d-b7c2-762e1e500ae0",
        "latencyMs": 25951,
        "namedScores": {},
        "prompt": {
          "raw": "You are a FACT EXTRACTION ENGINE.\n\nYou are given:\n- SOURCE CODE (Java or SQL)\n- GENERATED WIKI (Markdown)\n\n--- SOURCE CODE ---\nCREATE OR REPLACE PROCEDURE JIBSOJHJKNCHK(\r\n--1.0.000.000-05.00-03.00\r\n                                                        i_NSHORIBI              IN  NUMBER,\r\n                                                        i_VMACHINE_NAME         IN  NVARCHAR2,\r\n                                                        i_NSHOKUIN_NO           IN  NVARCHAR2,\r\n                                                        o_NSQL_CODE             OUT NUMBER,\r\n                                                        o_VSQL_MSG              OUT NVARCHAR2)\r\nIS\r\n--------------------------------------------------------\r\n--  業務名        JIB(住民記録)\r\n--  PG 名         JIBSOJHJKNCHK\r\n--  名称          住居表示変更条件FDデータチェック\r\n--  処理概要      媒体データ内容臨時保存用テーブル(JIBWJUSHOHENKO_TMP)より住居\r\n--                表示変更条件FDデータを読み込み、データの内容をチェックする。データ\r\n--                内容が不正の場合はエラーデータテーブル(JIBTJUSHOHENKO_JKN_ERR)に\r\n--                出力する\r\n--  作成者        ZCZL.DUANDONGLIN\r\n--  作成日        2022/07/28\r\n--  Version       0.2.000.000\r\n--------------------------------------------------------\r\n--  修正概要      : 支所CDをCHAR(3)に変更\r\n--  バージョン    : 0.0.000.000\r\n--  修正者／修正日: JIP H.Furui   2022/08/19\r\n--------------------------------------------------------\r\n--------------------------------------------------------------------------------\r\n--  カーソル定義\r\n--------------------------------------------------------------------------------\r\n    CURSOR CFD_FILE IS\r\n      SELECT A.DATA\r\n        FROM JIBWJUSHOHENKO_TMP A;\r\n\r\n------------------------------------------------------------------------------\r\n--  定数宣言\r\n------------------------------------------------------------------------------\r\n  -- 処理結果\r\n  c_ISUCCESS       CONSTANT  PLS_INTEGER := 0;         -- 正常\r\n  c_INOT_SUCCESS   CONSTANT  PLS_INTEGER := -1;        -- 異常\r\n  c_IRETNG         CONSTANT  PLS_INTEGER := 1;\r\n  -- JIBTJUSHOHENKO_JKNの削除を行う\r\n  c_VTABLE         CONSTANT  NVARCHAR2(128) :=   'JIBTJUSHOHENKO_JKN_ERR';\r\n  c_VTABLE1        CONSTANT  NVARCHAR2(128) :=   'JIBWJUSHOHENKO_KEY';\r\n  --旧自治体区分\r\n  I_JICHI_KBN      CONSTANT  NUMBER := 1;\r\n------------------------------------------------------------------------------\r\n--  変数宣言\r\n------------------------------------------------------------------------------\r\n  RTN                       PLS_INTEGER;\r\n  VSQLERRM                  NVARCHAR2(256);\r\n  TACONSPRM                 A_CONS_PRM;  --配列\r\n  NPRM_LENGTH               NUMBER;      --配列の長\r\n  CTLPRM1                   NUMBER;\r\n  CTLPRM2                   NUMBER;\r\n  CTLPRM3                   NUMBER;\r\n  CTLPRM4                   NUMBER;\r\n  CTLPRM5                   NUMBER;\r\n  CTLPRM6                   NUMBER;\r\n  CTLPRM7                   NUMBER;\r\n  CTLPRM8                   NUMBER;\r\n  CTLPRM9                   NUMBER;\r\n  VDATA                     NVARCHAR2(3000);\r\n  NCOUNT                    NUMBER := 1;\r\n  NPOINT                    NUMBER := 0;\r\n  NENTER_POINT              NUMBER;\r\n  NUM                       NUMBER := 0;\r\n  NDATACOUNT                NUMBER := 0; --入力データ件数\r\n  NERRDATACOUNT             NUMBER := 0; --エラーデータ件数\r\n  NERRORFLG                 NUMBER := 0; --エラーデータ有無(0:無, 1:有)\r\n\r\n  VBF_CITY_CD               NVARCHAR2(100);\r\n  VBF_JICHI_CD              NVARCHAR2(100);\r\n  VBF_OAZA_CD               NVARCHAR2(100);\r\n  VBF_HONBAN                NVARCHAR2(100);\r\n  VBF_EDABAN1               NVARCHAR2(100);\r\n  VBF_EDABAN2               NVARCHAR2(100);\r\n  VBF_EDABAN3               NVARCHAR2(100);\r\n  VBF_BANCHI_HENSHU_TYPE    NVARCHAR2(100);\r\n  VAF_CITY_CD               NVARCHAR2(100);\r\n  VAF_JICHI_CD              NVARCHAR2(100);\r\n  VAF_OAZA_CD               NVARCHAR2(100);\r\n  VAF_HONBAN                NVARCHAR2(100);\r\n  VAF_EDABAN1               NVARCHAR2(100);\r\n  VAF_EDABAN2               NVARCHAR2(100);\r\n  VAF_EDABAN3               NVARCHAR2(100);\r\n  VAF_BANCHI_HENSHU_TYPE    NVARCHAR2(100);\r\n  VAF_YUBIN_NO              NVARCHAR2(100);\r\n  VSHISHO_CD                NVARCHAR2(100);\r\n  VCHIKU_CD                 NVARCHAR2(100);\r\n  VGYOSEIKU_CD              NVARCHAR2(100);\r\n  VHAN_CD                   NVARCHAR2(100);\r\n  VSHOGAKU_CD               NVARCHAR2(100);\r\n  VCHUGAKU_CD               NVARCHAR2(100);\r\n  VTOHYOKU_CD               NVARCHAR2(100);\r\n  VGOMI_CD                  NVARCHAR2(100);\r\n  VSINYO_CD                 NVARCHAR2(100);\r\n\r\n  RJUSHOHENKO_JKN_ERR       JIBTJUSHOHENKO_JKN_ERR%ROWTYPE;\r\n  RJUSHOHENKO_KEY           JIBWJUSHOHENKO_KEY%ROWTYPE;\r\n  VCDERR                    NVARCHAR2(20);\r\n  IRET                      NUMBER;\r\n  NINDEX                    NUMBER;\r\n  NAMOUNT                   INTEGER;\r\n  NBAK_INDEX                NUMBER  := 1;\r\n  NBLOB_BUFFER              RAW(30000);\r\n  NOFFSET                   INTEGER := 1;\r\n  BRET                      BOOLEAN;\r\n  BOUT_ISNULL               BOOLEAN;\r\n  NSQLCOUNT                 NUMBER;\r\n  NJOKEN                    NUMBER;\r\n  W_ERRFLG                  PLS_INTEGER;\r\n  W_ERRFLG1                 NVARCHAR2(300);\r\n  W_ERRFLG2                 NVARCHAR2(20);\r\n  V_ERRFLG                  NVARCHAR2(10);\r\n  --住所からの行政情報自動設定の項目宣言\r\n  O_GYOSEIKU_CD             NUMBER;\r\n  O_HANCD                   NUMBER;\r\n  O_SHOGAKU_CD              NUMBER;\r\n  O_CHUGAKU_CD              NUMBER;\r\n  O_TOHYOKU_CD              NUMBER;\r\n--2022/08/19 H.Furui Mod Start\r\n--  O_SHISHO_CD               NUMBER;\r\n  O_SHISHO_CD               CHAR(3);\r\n--2022/08/19 H.Furui Mod End\r\n  O_CHIKU_CD                NUMBER;\r\n  O_SANTEIDANTAI_CD         NUMBER;\r\n  O_SQLCODE                 NUMBER;\r\n  --文字列中に記号のチェック\r\n  BKIGOUFLG1                BOOLEAN;\r\n  BKIGOUFLG2                BOOLEAN;\r\n  BKIGOUFLG3                BOOLEAN;\r\n  BKIGOUFLG4                BOOLEAN;\r\n  BKIGOUFLG5                BOOLEAN;\r\n  BKIGOUFLG6                BOOLEAN;\r\n  o_tITEM                   A_CONS_PRM;\r\n  nRTN                      PLS_INTEGER;\r\n--------------------------------------------------------------------------------\r\n--数値チェック\r\n--------------------------------------------------------------------------------\r\nFUNCTION EBPFCHKNUMERIC(i_VCHAR IN NVARCHAR2, o_ISNULL OUT BOOLEAN)RETURN BOOLEAN IS\r\nBRTN        BOOLEAN;\r\n\r\nBEGIN\r\n  o_ISNULL := FALSE;\r\n  IF i_VCHAR IS NULL THEN\r\n    BRTN := FALSE;\r\n    o_ISNULL := TRUE;\r\n  ELSIF TRIM(TRANSLATE(i_VCHAR,'0123456789','          ')) IS NULL THEN\r\n    BRTN := TRUE;\r\n  ELSE\r\n    BRTN := FALSE;\r\n  END IF;\r\n  \r\n  RETURN BRTN;\r\n\r\nEND EBPFCHKNUMERIC;\r\n--------------------------------------------------------------------------------\r\n--桁数チェック\r\n--------------------------------------------------------------------------------\r\nFUNCTION EBPFCHKIKETASU(i_VCHAR IN NVARCHAR2,i_IKETASU  IN PLS_INTEGER) RETURN BOOLEAN IS\r\nBRTN        BOOLEAN;\r\n\r\nBEGIN\r\n\r\n  -- 桁数チェック\r\n  IF i_IKETASU <> 0 THEN\r\n    IF ( LENGTH(i_VCHAR) > i_IKETASU ) THEN\r\n      BRTN := FALSE;\r\n    ELSE\r\n      BRTN := TRUE;\r\n    END IF;\r\n  END IF;\r\n  \r\n  RETURN BRTN;\r\n\r\nEND EBPFCHKIKETASU;\r\n--------------------------------------------------------------------------------\r\n--コード変換チェック\r\n--------------------------------------------------------------------------------\r\nFUNCTION EBPFCHKCDHENKOU(i_VCHAR  IN NVARCHAR2,i_NKEN  IN NUMBER)RETURN NUMBER IS\r\nNSQL_COUNT   NUMBER;\r\n  BEGIN\r\n    SELECT COUNT(*)\r\n      INTO NSQL_COUNT\r\n      FROM GABTGYOSEIJOHO\r\n     WHERE GYOSEI_JOHO_CD = i_VCHAR\r\n       AND GYOSEI_JOHO_KBN=i_NKEN\r\n       AND KYU_JICHITAI_KBN=1;\r\n      RETURN NSQL_COUNT;\r\n  EXCEPTION\r\n     WHEN NO_DATA_FOUND THEN\r\n       NSQL_COUNT := 0;\r\n     WHEN OTHERS THEN\r\n       NSQL_COUNT := 0;\r\n    RETURN NSQL_COUNT;\r\n\r\nEND EBPFCHKCDHENKOU;\r\n--------------------------------------------------------------------------------\r\nFUNCTION EBPFCHKCDHENKOU1(i_VCHAR  IN NVARCHAR2,i_NKEN  IN NUMBER)RETURN NUMBER IS\r\nNSQL_COUNT   NUMBER;\r\n  BEGIN\r\n    SELECT COUNT(*)\r\n      INTO NSQL_COUNT\r\n      FROM KKATCD\r\n     WHERE \r\n        GYOUMUCODE = 'JIB' \r\n        AND TRIM(ANYCODE) = TRIM(i_VCHAR)\r\n        AND TRIM(CODECODE) = TO_CHAR(TRIM(i_NKEN),'FM000')\r\n        AND GROUPCODE = '0000';\r\n      RETURN NSQL_COUNT;\r\n  EXCEPTION\r\n     WHEN NO_DATA_FOUND THEN\r\n       NSQL_COUNT := 0;\r\n     WHEN OTHERS THEN\r\n       NSQL_COUNT := 0;\r\n    RETURN NSQL_COUNT;\r\n\r\nEND EBPFCHKCDHENKOU1;\r\n--------------------------------------------------------------------------------\r\n--その他のチェック（項目相関チェックやキイ項目の同番チェック）\r\n--------------------------------------------------------------------------------\r\nFUNCTION EBPFCHKSONOTA(i_VCITYCD IN NVARCHAR2,i_VOAZACD IN NVARCHAR2,i_VHONBAN IN NVARCHAR2,\r\n                       i_VEDABAN1 IN NVARCHAR2,i_VEDABAN2 IN NVARCHAR2,i_VEDABAN3 IN NVARCHAR2)\r\n                       RETURN NUMBER IS\r\n\r\nNSQL_COUNT   NUMBER;\r\n  BEGIN\r\n    SELECT COUNT(*)\r\n      INTO NSQL_COUNT\r\n      FROM JIBWJUSHOHENKO_KEY\r\n     WHERE BF_CITY_CD = i_VCITYCD\r\n       AND BF_OAZA_CD = i_VOAZACD\r\n       AND BF_HONBAN  = i_VHONBAN\r\n       AND BF_EDABAN1 = i_VEDABAN1\r\n       AND BF_EDABAN2 = i_VEDABAN2\r\n       AND BF_EDABAN3 = i_VEDABAN3;\r\n      RETURN NSQL_COUNT;\r\n  EXCEPTION\r\n     WHEN NO_DATA_FOUND THEN\r\n       NSQL_COUNT := 0;\r\n     WHEN OTHERS THEN\r\n       NSQL_COUNT := 0;\r\n    RETURN NSQL_COUNT;\r\n\r\nEND EBPFCHKSONOTA;\r\n--------------------------------------------------------------------------------\r\n--変更前の住所コード（BF_CITY_CD, BF_OAZA_CD, BF_HONBAN, BF_EDABAN1, BF_EDABAN2, BF_EDABAN3）が\r\n--ここまでのチェックでエラーが無い場合\r\n--?I同番\r\nPROCEDURE EBPFTOONAJIBANCHK(i_BFCITYCD IN NVARCHAR2,i_BFOAZACD IN NVARCHAR2,i_BFHONBAN IN NVARCHAR2,\r\n                           i_BFEDABAN1 IN NVARCHAR2,i_BFEDABAN2 IN NVARCHAR2,i_BFEDABAN3 IN NVARCHAR2) IS\r\nV_BFEDABAN1   NVARCHAR2(20);\r\nV_BFEDABAN2   NVARCHAR2(20);\r\nV_BFEDABAN3   NVARCHAR2(20);\r\nBEGIN\r\n\r\n  IF i_BFEDABAN1 IS NULL THEN\r\n     V_BFEDABAN1 := 0;\r\n  ELSE\r\n     V_BFEDABAN1 := i_BFEDABAN1;\r\n  END IF;\r\n\r\n  IF i_BFEDABAN2 IS NULL THEN\r\n     V_BFEDABAN2 := 0;\r\n  ELSE\r\n     V_BFEDABAN2 := i_BFEDABAN2;\r\n  END IF;\r\n\r\n  IF i_BFEDABAN3 IS NULL THEN\r\n     V_BFEDABAN3 := 0;\r\n  ELSE\r\n     V_BFEDABAN3 := i_BFEDABAN3;\r\n  END IF;\r\n\r\n  --同番チェック用ワークテーブル(JIBWJUSHOHENKO_KEY)を読込む。\r\n  NSQLCOUNT := EBPFCHKSONOTA(i_BFCITYCD , i_BFOAZACD , i_BFHONBAN , V_BFEDABAN1 , V_BFEDABAN2 , V_BFEDABAN3);\r\n\r\n  IF NSQLCOUNT > 0 THEN\r\n    RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR || '$';\r\n    RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR || '$';\r\n    RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR  := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR  || '$';\r\n    RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '$';\r\n    RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR || '$';\r\n    RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR || '$';\r\n  END IF;\r\n\r\nEND EBPFTOONAJIBANCHK;\r\n--------------------------------------------------------------------------------\r\n--エラーデータ初期化処理\r\n--------------------------------------------------------------------------------\r\nPROCEDURE PROCCLEAR IS\r\nBEGIN\r\n  RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR           := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR             := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR           := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR             := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := '';\r\n  RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR           := '';\r\n  RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR             := '';\r\n  RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR              := '';\r\n  RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR           := '';\r\n  RJUSHOHENKO_JKN_ERR.HAN_CD_ERR                := '';\r\n  RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR               := '';\r\n  RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR              := '';\r\nEND PROCCLEAR;\r\n--------------------------------------------------------------------------------\r\n-- メイン処理                                                                 --\r\n--------------------------------------------------------------------------------\r\nBEGIN\r\n  -- １．初期処理\r\n  -- ?@テーブル「JIBTJUSHOHENKO_JKN_ERR」のデータを削除する。\r\n  RTN := KKAPK3000.FTRUNCATE(c_VTABLE, VSQLERRM);\r\n  IF RTN <> 0 THEN\r\n    o_NSQL_CODE := c_INOT_SUCCESS;\r\n    o_VSQL_MSG  := SUBSTR(TO_CHAR(SQLERRM),1,255);\r\n    RETURN;\r\n  END IF;\r\n\r\n  --?@テーブル「JIBWJUSHOHENKO_KEY」のデータを削除する。\r\n  RTN := KKAPK3000.FTRUNCATE(c_VTABLE1, VSQLERRM);\r\n  IF RTN <> 0 THEN\r\n    o_NSQL_CODE := c_INOT_SUCCESS;\r\n    o_VSQL_MSG  := SUBSTR(TO_CHAR(SQLERRM),1,255);\r\n    RETURN;\r\n  END IF;\r\n\r\n  -- ?A行政情報設定用の制御パラメータを取得する。\r\n  RTN := KKAPK0030.FPRMSHUTOKU('JIB',\r\n                                '00JHGYOSEIJOHO',\r\n                                '0',\r\n                                TACONSPRM,\r\n                                NPRM_LENGTH);\r\n  --パラメータを取得できない場合、ディフォト値ゼロを設定する。\r\n  IF ((RTN = c_ISUCCESS) AND (TACONSPRM.LAST IS NULL)) OR\r\n      (RTN = c_IRETNG) THEN\r\n    CTLPRM1 := 0;\r\n    CTLPRM2 := 0;\r\n    CTLPRM3 := 0;\r\n    CTLPRM4 := 0;\r\n    CTLPRM5 := 0;\r\n    CTLPRM6 := 0;\r\n    CTLPRM7 := 0;\r\n    CTLPRM8 := 0;\r\n    CTLPRM9 := 0;\r\n  ELSE\r\n    FOR ICNT IN TACONSPRM.FIRST..TACONSPRM.LAST LOOP\r\n      CASE ICNT\r\n        WHEN 1 THEN\r\n          CTLPRM1 := NVL(TACONSPRM(1),0);\r\n        WHEN 2 THEN\r\n          CTLPRM2 := NVL(TACONSPRM(2),0);\r\n        WHEN 3 THEN\r\n          CTLPRM3 := NVL(TACONSPRM(3),0);\r\n        WHEN 4 THEN\r\n          CTLPRM4 := NVL(TACONSPRM(4),0);\r\n        WHEN 5 THEN\r\n          CTLPRM5 := NVL(TACONSPRM(5),0);\r\n        WHEN 6 THEN\r\n          CTLPRM6 := NVL(TACONSPRM(6),0);\r\n        WHEN 7 THEN\r\n          CTLPRM7 := NVL(TACONSPRM(7),0);\r\n        WHEN 8 THEN\r\n          CTLPRM8 := NVL(TACONSPRM(8),0);\r\n        WHEN 9 THEN\r\n          CTLPRM9 := NVL(TACONSPRM(9),0);\r\n        ELSE\r\n          NULL;\r\n      END CASE;\r\n    END LOOP;\r\n  END IF;\r\n\r\n  -- ２．データ抽出\r\n  FOR RCFD_FILE IN CFD_FILE LOOP\r\n\r\n    -- 第一個ENTERキーの位置を取得する\r\n    NINDEX                         := DBMS_LOB.INSTR(RCFD_FILE.DATA,UTL_RAW.CAST_TO_RAW(CHR(13)),1,NCOUNT);\r\n    NAMOUNT                        := NINDEX - 1;\r\n    WHILE NINDEX <> NBAK_INDEX LOOP\r\n\r\n    --エラーデータ初期化処理\r\n    PROCCLEAR;\r\n\r\n    IF NINDEX = 0 THEN\r\n      --一行データのみ\r\n      IF NBAK_INDEX = 1 THEN\r\n        VDATA                      := CONVERT(UTL_RAW.CAST_TO_VARCHAR2(RCFD_FILE.DATA), 'UTF8', 'JA16SJIS');\r\n      ELSE\r\n        NAMOUNT                    := DBMS_LOB.GETLENGTH(RCFD_FILE.DATA) - NBAK_INDEX - 1;\r\n        NBLOB_BUFFER               := DBMS_LOB.SUBSTR(RCFD_FILE.DATA,NAMOUNT,NBAK_INDEX + 2);\r\n        VDATA                      := CONVERT(UTL_RAW.CAST_TO_VARCHAR2(NBLOB_BUFFER), 'UTF8', 'JA16SJIS');\r\n      END IF;\r\n      NBAK_INDEX                   := 0;\r\n    --複数行データの場合\r\n    ELSE\r\n      NBLOB_BUFFER                 := DBMS_LOB.SUBSTR(RCFD_FILE.DATA,NAMOUNT,NOFFSET);\r\n      NOFFSET := NOFFSET + NAMOUNT + 2;\r\n      VDATA                        := CONVERT(UTL_RAW.CAST_TO_VARCHAR2(NBLOB_BUFFER), 'UTF8', 'JA16SJIS');\r\n    END IF;\r\n    VDATA                          := REPLACE(VDATA,'\"','');\r\n    NDATACOUNT                     := NDATACOUNT + 1;\r\n\r\n    --毎行データ中に、データがある場合\r\n    IF LENGTH(TRIM(VDATA)) > 0 THEN\r\n      VDATA                        := VDATA || ',,,,,,,,,,,,,,,,,,,,,,,,,,';\r\n\r\n-- １、変更前市区町村コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_CITY_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VBF_CITY_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VBF_CITY_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTSHIKUCHOSON\r\n           WHERE JICHI_CD = VBF_CITY_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２、変更前自治コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_JICHI_CD                 := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VBF_JICHI_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VBF_JICHI_CD,6);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTSHIKUCHOSON\r\n           WHERE JICHITAI_CD = VBF_JICHI_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ３、変更前大字コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_OAZA_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VBF_OAZA_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VBF_OAZA_CD,6);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTOAZA\r\n           WHERE OAZA_CD = VBF_OAZA_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ４、変更前本番\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_HONBAN                   := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VBF_HONBAN,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VBF_HONBAN,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR || '#';\r\n      END IF;\r\n\r\n-- ５、変更前枝番１\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_EDABAN1                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      IF VBF_EDABAN1 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VBF_EDABAN1,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VBF_EDABAN1,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ６、変更前枝番２\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_EDABAN2                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      IF VBF_EDABAN2 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VBF_EDABAN2,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VBF_EDABAN2,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ７、変更前枝番３\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_EDABAN3                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      IF VBF_EDABAN3 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VBF_EDABAN3,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VBF_EDABAN3,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ８、変更前番地編集タイプ\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VBF_BANCHI_HENSHU_TYPE       := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VBF_BANCHI_HENSHU_TYPE,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VBF_BANCHI_HENSHU_TYPE,2);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTBANCHIHENSHU\r\n           WHERE BANCHI_HENSHU_CD = VBF_BANCHI_HENSHU_TYPE;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ９、変更後市区町村コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_CITY_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_CITY_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_CITY_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTSHIKUCHOSON\r\n           WHERE JICHI_CD = VAF_CITY_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １０、変更後自治コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_JICHI_CD                 := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_JICHI_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_JICHI_CD,6);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTSHIKUCHOSON\r\n           WHERE JICHITAI_CD = VAF_JICHI_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １１、変更後大字コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_OAZA_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_OAZA_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_OAZA_CD,6);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTOAZA\r\n           WHERE OAZA_CD = VAF_OAZA_CD;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １２、変更後本番\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_HONBAN                   := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_HONBAN,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_HONBAN,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '#';\r\n      END IF;\r\n\r\n--１３、変更後枝番１\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_EDABAN1                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      IF VAF_EDABAN1 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VAF_EDABAN1,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VAF_EDABAN1,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １４、変更後枝番２\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_EDABAN2                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      IF VAF_EDABAN2 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VAF_EDABAN2,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VAF_EDABAN2,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １５、変更後枝番３\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_EDABAN3                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n      IF VAF_EDABAN3 IS NOT NULL THEN\r\n        --?@データタイプのチェック\r\n        BRET := EBPFCHKNUMERIC(VAF_EDABAN3,BOUT_ISNULL);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR := '*';\r\n        END IF;\r\n\r\n        --?Aデータ長のチェック\r\n        BRET := EBPFCHKIKETASU(VAF_EDABAN3,5);\r\n        IF BRET = FALSE THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR || '&';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １６、変更後番地編集タイプ\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_BANCHI_HENSHU_TYPE       := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_BANCHI_HENSHU_TYPE,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_BANCHI_HENSHU_TYPE,2);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR || '#';\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR IS NULL THEN\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM GABTBANCHIHENSHU\r\n           WHERE BANCHI_HENSHU_CD = VAF_BANCHI_HENSHU_TYPE;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １７、変更後郵便番号\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VAF_YUBIN_NO                 := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VAF_YUBIN_NO,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VAF_YUBIN_NO,7);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR := RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR := RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR || '#';\r\n      END IF;\r\n\r\n-- １８、支所コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VSHISHO_CD                   := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VSHISHO_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VSHISHO_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM9 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR || '#';\r\n      ELSIF CTLPRM9 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VSHISHO_CD <> '0' AND VSHISHO_CD <> '' AND VSHISHO_CD IS NOT NULL THEN\t--2013/08/02 T.ABE ADD\r\n           RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR || '#';\r\n        END IF;\t\t\t\t\t\t\t\t\t\t--2013/08/02 T.ABE ADD\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n--      IF RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR IS NULL THEN\t\t\t\t--2013/08/02 T.ABE DEL\r\n--2013/08/02 T.ABE ADD Start\r\n      IF RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR IS NULL\r\n         AND VSHISHO_CD <> '0' AND VSHISHO_CD <> '' AND VSHISHO_CD IS NOT NULL THEN\r\n--2013/08/02 T.ABE ADD End\r\n        BEGIN\r\n          SELECT COUNT(*)\r\n            INTO NSQLCOUNT\r\n            FROM KKATCD\r\n           WHERE \r\n              GYOUMUCODE = 'KKN'\r\n              AND   CODECODE ='001'\r\n              AND   GROUPCODE = '0000' \r\n              AND   TO_CHAR(TRIM(ANYCODE),'FM000') =TO_CHAR(TRIM(VSHISHO_CD),'FM000');\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NSQLCOUNT := 0;\r\n          WHEN OTHERS THEN\r\n            NSQLCOUNT := 0;\r\n        END;\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- １９、地区コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VCHIKU_CD                    := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VCHIKU_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VCHIKU_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM2 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR || '#';\r\n      ELSIF CTLPRM2 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VCHIKU_CD <> '0' AND VCHIKU_CD <> '' AND VCHIKU_CD IS NOT NULL THEN\t--2013/08/02 T.ABE ADD\r\n           RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR || '#';\r\n        END IF;\t\t\t\t\t\t\t\t\t--2013/08/02 T.ABE ADD\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR IS NULL\r\n         AND VCHIKU_CD <> '0' AND VCHIKU_CD <> '' AND VCHIKU_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VCHIKU_CD,1);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２０、行政区コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VGYOSEIKU_CD                 := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VGYOSEIKU_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VGYOSEIKU_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM1 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || '#';\r\n      ELSIF CTLPRM1 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VGYOSEIKU_CD <> '0' AND VGYOSEIKU_CD <> '' AND VGYOSEIKU_CD IS NOT NULL THEN\t\t--2013/08/02 T.ABE ADD\r\n           RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || '#';\r\n        END IF;\t\t\t\t\t\t\t\t\t\t\t--2013/08/02 T.ABE ADD\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n--      IF RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR IS NULL THEN\t\t\t\t\t--2013/08/02 T.ABE DEL\r\n      IF RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR IS NULL\t\t\t\t\t\t--2013/08/02 T.ABE ADD\r\n         AND VGYOSEIKU_CD <> '0' AND VGYOSEIKU_CD <> '' AND VGYOSEIKU_CD IS NOT NULL THEN\t--2013/08/02 T.ABE ADD\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VGYOSEIKU_CD,2);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２１、班コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VHAN_CD                      := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VHAN_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VHAN_CD,15);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := RJUSHOHENKO_JKN_ERR.HAN_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM3 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := RJUSHOHENKO_JKN_ERR.HAN_CD_ERR || '#';\r\n      ELSIF CTLPRM3 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VHAN_CD <> '0' AND VHAN_CD <> '' AND VHAN_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := RJUSHOHENKO_JKN_ERR.HAN_CD_ERR || '#';\r\n        END IF;\t\t\t\t\t\t\t\t\t\t--2013/08/02 T.ABE ADD\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.HAN_CD_ERR IS NULL\t\r\n         AND VHAN_CD <> '0' AND VHAN_CD <> '' AND VHAN_CD IS NOT NULL THEN\r\n        BEGIN\r\n             nRTN := KKAPK0030.FCTGetR('JIB','SYSTEM_JOKEN','0001',1,o_tITEM);\r\n              IF nRTN = 0 THEN\r\n                NJOKEN := o_tITEM(1);\r\n              ELSE \r\n                NJOKEN := 0;\r\n              END IF;\r\n        EXCEPTION\r\n          WHEN NO_DATA_FOUND THEN\r\n            NJOKEN := 0;\r\n          WHEN OTHERS THEN\r\n            NJOKEN := 0;\r\n        END;\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VHAN_CD,3);\r\n        IF NJOKEN = 1 THEN\r\n          IF NSQLCOUNT = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := RJUSHOHENKO_JKN_ERR.HAN_CD_ERR || '@';\r\n          END IF;\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２２、小学校コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VSHOGAKU_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VSHOGAKU_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VSHOGAKU_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM4 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR || '#';\r\n      ELSIF CTLPRM4 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VSHOGAKU_CD <> '0' AND VSHOGAKU_CD <> '' AND VSHOGAKU_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR || '#';\r\n        END IF;\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR IS NULL\r\n         AND VSHOGAKU_CD <> '0' AND VSHOGAKU_CD <> '' AND VSHOGAKU_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VSHOGAKU_CD,4);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２３、中学校コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VCHUGAKU_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VCHUGAKU_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VCHUGAKU_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM5 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR || '#';\r\n      ELSIF CTLPRM5 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VCHUGAKU_CD <> '0' AND VCHUGAKU_CD <> '' AND VCHUGAKU_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR || '#';\r\n        END IF;\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR IS NULL\t\r\n         AND VCHUGAKU_CD <> '0' AND VCHUGAKU_CD <> '' AND VCHUGAKU_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VCHUGAKU_CD,5);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２４、投票区コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VTOHYOKU_CD                  := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VTOHYOKU_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VTOHYOKU_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM6 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR || '#';\r\n      ELSIF CTLPRM6 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VTOHYOKU_CD <> '0' AND VTOHYOKU_CD <> '' AND VTOHYOKU_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR || '#';\r\n        END IF;\t\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR IS NULL\t\r\n         AND VTOHYOKU_CD <> '0' AND VTOHYOKU_CD <> '' AND VTOHYOKU_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU(VTOHYOKU_CD,6);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２５、ごみ業者コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VGOMI_CD                     := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VGOMI_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VGOMI_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR := RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM7 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR := RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR || '#';\r\n      ELSIF CTLPRM7 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VGOMI_CD <> '0' AND VGOMI_CD <> '' AND VGOMI_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR := RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR || '#';\r\n        END IF;\t\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR IS NULL\r\n         AND VGOMI_CD <> '0' AND VGOMI_CD <> '' AND VGOMI_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU1(VGOMI_CD,30);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR := RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n-- ２６、し尿業者コード\r\n      NPOINT                       := INSTR(VDATA, ',');\r\n      VSINYO_CD                    := TRIM(SUBSTR(VDATA, 1, NPOINT - 1));\r\n      VDATA                        := SUBSTR(VDATA, NPOINT + 1);\r\n\r\n      --?@データタイプのチェック\r\n      BRET := EBPFCHKNUMERIC(VSINYO_CD,BOUT_ISNULL);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR := '*';\r\n      END IF;\r\n\r\n      --?Aデータ長のチェック\r\n      BRET := EBPFCHKIKETASU(VSINYO_CD,5);\r\n      IF BRET = FALSE THEN\r\n        RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR := RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR || '&';\r\n      END IF;\r\n\r\n      --?B必須項目のチェック\r\n      IF CTLPRM8 = 1 AND BOUT_ISNULL = TRUE THEN\r\n        RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR := RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR || '#';\r\n      ELSIF CTLPRM8 <> 1 AND BOUT_ISNULL = FALSE THEN\r\n        IF VSINYO_CD <> '0' AND VSINYO_CD <> '' AND VSINYO_CD IS NOT NULL THEN\r\n           RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR := RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR || '#';\r\n        END IF;\t\r\n      END IF;\r\n\r\n      --?Cコード変換チェック\r\n      IF RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR IS NULL\r\n         AND VSINYO_CD <> '0' AND VSINYO_CD <> '' AND VSINYO_CD IS NOT NULL THEN\r\n        NSQLCOUNT := EBPFCHKCDHENKOU1(VSINYO_CD,31);\r\n        IF NSQLCOUNT = 0 THEN\r\n          RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR := RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR || '@';\r\n        END IF;\r\n      END IF;\r\n\r\n      --その他のチェック\r\n      --BF_EDABAN1その他チェック \r\n      --?@相関1\r\n      IF VBF_EDABAN1 IS NOT NULL THEN\r\n        IF VBF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR || '%';\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '%';\r\n        END IF;\r\n      END IF;\r\n\r\n      --BF_EDABAN2その他チェック\r\n      --?A相関2\r\n      W_ERRFLG := 0;\r\n      IF VBF_EDABAN2 IS NOT NULL THEN\r\n        IF VBF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VBF_EDABAN1 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR || '%';\r\n      END IF;\r\n\r\n      --BF_EDABAN3その他チェック\r\n      --?B相関3\r\n      W_ERRFLG := 0;\r\n      IF VBF_EDABAN3 IS NOT NULL THEN\r\n        IF VBF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VBF_EDABAN1 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VBF_EDABAN2 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR || '%';\r\n      END IF;\r\n\r\n      --?I同番\r\n      IF RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR IS NULL AND RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR IS NULL AND \r\n         RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR IS NULL AND RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR IS NULL AND \r\n         RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR IS NULL AND RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR IS NULL THEN\r\n        EBPFTOONAJIBANCHK(VBF_CITY_CD , VBF_OAZA_CD , VBF_HONBAN , VBF_EDABAN1 , VBF_EDABAN2 , VBF_EDABAN3);\r\n      END IF;\r\n\r\n      --BF_BANCHI_HENSHU_TYPEその他チェック\r\n      --?C相関4\r\n      W_ERRFLG := 0;\r\n      IF RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR IS NULL THEN\r\n        IF VBF_BANCHI_HENSHU_TYPE > 20 THEN\r\n          IF VBF_EDABAN1 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n        IF VBF_BANCHI_HENSHU_TYPE > 30 THEN\r\n          IF VBF_EDABAN2 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n        IF VBF_BANCHI_HENSHU_TYPE > 40 THEN\r\n          IF VBF_EDABAN3 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR || '%';\r\n      END IF;\r\n\r\n      --AF_EDABAN1その他チェック\r\n      --?D相関5\r\n      IF VAF_EDABAN1 IS NOT NULL THEN\r\n        IF VAF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '%';\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '%';\r\n        END IF;\r\n      END IF;\r\n\r\n      --AF_EDABAN2その他チェック\r\n      --?E相関6\r\n      W_ERRFLG := 0;\r\n      IF VAF_EDABAN2 IS NOT NULL THEN\r\n        IF VAF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VAF_EDABAN1 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR || '%';\r\n      END IF;\r\n\r\n      --AF_EDABAN3その他チェック\r\n      --?F相関7\r\n      W_ERRFLG := 0;\r\n      IF VAF_EDABAN3 IS NOT NULL THEN\r\n        IF VAF_HONBAN IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VAF_EDABAN1 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n        IF VAF_EDABAN2 IS NULL THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR || '%';\r\n          W_ERRFLG := 1;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR || '%';\r\n      END IF;\r\n\r\n      --AF_BANCHI_HENSHU_TYPEその他チェック\r\n      --?G相関8\r\n      W_ERRFLG := 0;\r\n      IF RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR IS NULL THEN\r\n        IF VAF_BANCHI_HENSHU_TYPE > 20 THEN\r\n          IF VAF_EDABAN1 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n        IF VAF_BANCHI_HENSHU_TYPE > 30 THEN\r\n          IF VAF_EDABAN2 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n        IF VAF_BANCHI_HENSHU_TYPE > 40 THEN\r\n          IF VAF_EDABAN3 IS NULL THEN\r\n            RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n      END IF;\r\n      IF W_ERRFLG = 1 THEN\r\n        RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR := RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR || '%';\r\n      END IF;\r\n\r\n      --SHISHO_CDその他チェック\r\n      --住所からの行政情報取得する\r\n      IF (RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR IS NULL) AND\r\n         (RJUSHOHENKO_JKN_ERR.AF_HONBAN IS NULL) AND\r\n         (RJUSHOHENKO_JKN_ERR.AF_EDABAN1 IS NULL) AND\r\n         (RJUSHOHENKO_JKN_ERR.AF_EDABAN2 IS NULL) THEN\r\n        JIBSKGYOSEGET(I_JICHI_KBN,\r\n                               VAF_OAZA_CD,\r\n                               VAF_HONBAN,\r\n                               VAF_EDABAN1,\r\n                               VAF_EDABAN2,\r\n                               O_GYOSEIKU_CD,\r\n                               O_HANCD,\r\n                               O_SHOGAKU_CD,\r\n                               O_CHUGAKU_CD,\r\n                               O_TOHYOKU_CD,\r\n                               O_SHISHO_CD,\r\n                               O_CHIKU_CD,\r\n                               O_SANTEIDANTAI_CD,\r\n                               O_SQLCODE);\r\n        --?H相関9-1\r\n        W_ERRFLG := 0;\r\n        IF CTLPRM9 = 2 THEN\r\n          IF O_SHISHO_CD IS NULL OR O_SHISHO_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR := RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-2\r\n        IF CTLPRM2 = 2 THEN\r\n          IF O_CHIKU_CD IS NULL OR O_CHIKU_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-3\r\n        IF CTLPRM1 = 2 THEN\r\n          IF O_GYOSEIKU_CD IS NULL OR O_GYOSEIKU_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR := RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-4\r\n        IF CTLPRM3 = 2 THEN\r\n          IF O_HANCD IS NULL OR O_HANCD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.HAN_CD_ERR := RJUSHOHENKO_JKN_ERR.HAN_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-5\r\n        IF CTLPRM4 = 2 THEN\r\n          IF O_SHOGAKU_CD IS NULL OR O_SHOGAKU_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-6\r\n        IF CTLPRM5 = 2 THEN\r\n          IF O_CHUGAKU_CD IS NULL OR O_CHUGAKU_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR := RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H相関9-7\r\n        IF CTLPRM6 = 2 THEN\r\n          IF O_TOHYOKU_CD IS NULL OR O_TOHYOKU_CD = 0 THEN\r\n            RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR := RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR || '%';\r\n            W_ERRFLG := 1;\r\n          END IF;\r\n        END IF;\r\n\r\n        --?H-end.\r\n        IF W_ERRFLG = 1 THEN\r\n          RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR := RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR || '%';\r\n          RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR := RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR || '%';\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR || '%';\r\n          RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR := RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR || '%';\r\n        END IF;\r\n      END IF;\r\n\r\n      --同番チェック用ワークテーブルの更新処理\r\n      --データチェック処理で不正の無かったデータは同番チェック用ワークテーブルに出力する。\r\n      IF RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR   IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR  IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR   IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR  IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR  IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR   IS NULL AND  RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.HAN_CD_ERR     IS NULL AND  RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR  IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR IS NULL AND  RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR  IS NULL AND\r\n         RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR    IS NULL AND  RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR    IS NULL THEN\r\n\r\n        --変更前市町村コード\r\n        RJUSHOHENKO_KEY.BF_CITY_CD := VBF_CITY_CD;\r\n\r\n        --変更前大字コード\r\n        RJUSHOHENKO_KEY.BF_OAZA_CD := VBF_OAZA_CD;\r\n\r\n        --変更前本番\r\n        RJUSHOHENKO_KEY.BF_HONBAN  := NVL(VBF_HONBAN,0);\r\n\r\n        --変更前枝番１\r\n        RJUSHOHENKO_KEY.BF_EDABAN1 := NVL(VBF_EDABAN1,0);\r\n\r\n        --変更前枝番２\r\n        RJUSHOHENKO_KEY.BF_EDABAN2 := NVL(VBF_EDABAN2,0);\r\n\r\n        --変更前枝番３\r\n        RJUSHOHENKO_KEY.BF_EDABAN3 := NVL(VBF_EDABAN3,0);\r\n\r\n        --作成日\r\n        RJUSHOHENKO_KEY.SYS_SAKUSEIBI := i_NSHORIBI;\r\n\r\n        --更新日\r\n        RJUSHOHENKO_KEY.SYS_KOSHINBI := 0;\r\n\r\n        --更新時間\r\n        RJUSHOHENKO_KEY.SYS_JIKAN  := TO_CHAR(SYSDATE, 'HH24MISS');\r\n\r\n        --更新職員個人番号\r\n        RJUSHOHENKO_KEY.SYS_SHOKUINKOJIN_NO := i_NSHOKUIN_NO;\r\n\r\n        --更新端末番号\r\n        RJUSHOHENKO_KEY.SYS_TANMATSU_NO := i_VMACHINE_NAME;\r\n\r\n        BEGIN\r\n          INSERT INTO JIBWJUSHOHENKO_KEY VALUES RJUSHOHENKO_KEY;\r\n        EXCEPTION\r\n          WHEN OTHERS THEN\r\n            ROLLBACK;\r\n            -- SQL情報取得\r\n            o_NSQL_CODE := c_INOT_SUCCESS;\r\n            o_VSQL_MSG  := SUBSTR(TO_CHAR(SQLERRM),1,255);\r\n            RETURN;\r\n        END;\r\n      ELSE\r\n      --エラーデータの更新処理\r\n      --データチェック処理で不正の有ったデータはエラーデータテーブル(JIBTJUSHOHENKO_JKN_ERR)に出力する。\r\n        --レコード連番\r\n        RJUSHOHENKO_JKN_ERR.RENBAN := NDATACOUNT;\r\n\r\n        W_ERRFLG1 := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR  || RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR || RJUSHOHENKO_JKN_ERR.BF_OAZA_CD_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.BF_HONBAN_ERR   || RJUSHOHENKO_JKN_ERR.BF_EDABAN1_ERR  || RJUSHOHENKO_JKN_ERR.BF_EDABAN2_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.BF_EDABAN3_ERR  || RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE_ERR || RJUSHOHENKO_JKN_ERR.AF_CITY_CD_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.AF_JICHI_CD_ERR || RJUSHOHENKO_JKN_ERR.AF_OAZA_CD_ERR  || RJUSHOHENKO_JKN_ERR.AF_HONBAN_ERR  ||\r\n                     RJUSHOHENKO_JKN_ERR.AF_EDABAN1_ERR  || RJUSHOHENKO_JKN_ERR.AF_EDABAN2_ERR  || RJUSHOHENKO_JKN_ERR.AF_EDABAN3_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE_ERR || RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO_ERR || RJUSHOHENKO_JKN_ERR.SHISHO_CD_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.CHIKU_CD_ERR    || RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD_ERR || RJUSHOHENKO_JKN_ERR.HAN_CD_ERR     ||\r\n                     RJUSHOHENKO_JKN_ERR.SHOGAKU_CD_ERR  || RJUSHOHENKO_JKN_ERR.CHUGAKU_CD_ERR  || RJUSHOHENKO_JKN_ERR.TOHYOKU_CD_ERR ||\r\n                     RJUSHOHENKO_JKN_ERR.GOMI_CD_ERR     || RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR;\r\n        W_ERRFLG2 := '';\r\n        BKIGOUFLG1 := FALSE;\r\n        BKIGOUFLG2 := FALSE;\r\n        BKIGOUFLG3 := FALSE;\r\n        BKIGOUFLG4 := FALSE;\r\n        BKIGOUFLG5 := FALSE;\r\n        BKIGOUFLG6 := FALSE;\r\n        FOR ICNT1 IN 1..LENGTH(W_ERRFLG1) LOOP\r\n          V_ERRFLG := TRIM(SUBSTR(W_ERRFLG1,ICNT1,1));\r\n          IF V_ERRFLG = '*' THEN\r\n            BKIGOUFLG1 := TRUE;\t\r\n          ELSIF V_ERRFLG = '&' THEN\r\n            BKIGOUFLG2 := TRUE;\r\n          ELSIF V_ERRFLG = '#' THEN\r\n            BKIGOUFLG3 := TRUE;\r\n          ELSIF V_ERRFLG = '@' THEN\r\n            BKIGOUFLG4 := TRUE;\r\n          ELSIF V_ERRFLG = '%' THEN\r\n            BKIGOUFLG5 := TRUE;\r\n          ELSIF V_ERRFLG = '$' THEN\r\n            BKIGOUFLG6 := TRUE;\r\n          END IF;\r\n        END LOOP;\r\n        IF BKIGOUFLG1 = TRUE THEN\r\n          W_ERRFLG2 := '*';\r\n        END IF;\r\n        IF BKIGOUFLG2 = TRUE THEN\r\n          W_ERRFLG2 := W_ERRFLG2 || '&';\r\n        END IF;\r\n        IF BKIGOUFLG3 = TRUE THEN\r\n          W_ERRFLG2 := W_ERRFLG2 || '#';\r\n        END IF;\r\n        IF BKIGOUFLG4 = TRUE THEN\r\n          W_ERRFLG2 := W_ERRFLG2 || '@';\r\n        END IF;\r\n        IF BKIGOUFLG5 = TRUE THEN\r\n          W_ERRFLG2 := W_ERRFLG2 || '%';\r\n        END IF;\r\n        IF BKIGOUFLG6 = TRUE THEN\r\n          W_ERRFLG2 := W_ERRFLG2 || '$';\r\n        END IF;\r\n        --代表エラーフラグ\r\n        RJUSHOHENKO_JKN_ERR.ERRFLG := SUBSTR(W_ERRFLG2,1,10);\r\n\r\n        --変更前市町村コード\r\n        RJUSHOHENKO_JKN_ERR.BF_CITY_CD := SUBSTR(VBF_CITY_CD,1,10);\r\n\r\n        --変更前自治コード（CD付）\r\n        RJUSHOHENKO_JKN_ERR.BF_JICHI_CD := SUBSTR(VBF_JICHI_CD,1,10);\r\n\r\n        --変更前大字コード\r\n        RJUSHOHENKO_JKN_ERR.BF_OAZA_CD := SUBSTR(VBF_OAZA_CD,1,10);\r\n\r\n        --変更前本番\r\n        RJUSHOHENKO_JKN_ERR.BF_HONBAN := SUBSTR(VBF_HONBAN,1,10);\r\n\r\n        --変更前枝番１\r\n        RJUSHOHENKO_JKN_ERR.BF_EDABAN1 := SUBSTR(VBF_EDABAN1,1,10);\r\n\r\n        --変更前枝番２\r\n        RJUSHOHENKO_JKN_ERR.BF_EDABAN2 := SUBSTR(VBF_EDABAN2,1,10);\r\n\r\n        --変更前枝番３\r\n        RJUSHOHENKO_JKN_ERR.BF_EDABAN3 := SUBSTR(VBF_EDABAN3,1,10);\r\n\r\n        --変更前番地編集タイプ\r\n        RJUSHOHENKO_JKN_ERR.BF_BANCHI_HENSHU_TYPE := SUBSTR(VBF_BANCHI_HENSHU_TYPE,1,10);\r\n\r\n        --変更後市町村コード\r\n        RJUSHOHENKO_JKN_ERR.AF_CITY_CD := SUBSTR(VAF_CITY_CD,1,10);\r\n\r\n        --変更後自治コード（CD付）\r\n        RJUSHOHENKO_JKN_ERR.AF_JICHI_CD := SUBSTR(VAF_JICHI_CD,1,10);\r\n\r\n        --変更後大字コード\r\n        RJUSHOHENKO_JKN_ERR.AF_OAZA_CD := SUBSTR(VAF_OAZA_CD,1,10);\r\n\r\n        --変更後本番\r\n        RJUSHOHENKO_JKN_ERR.AF_HONBAN := SUBSTR(VAF_HONBAN,1,10);\r\n\r\n        --変更後枝番１\r\n        RJUSHOHENKO_JKN_ERR.AF_EDABAN1 := SUBSTR(VAF_EDABAN1,1,10);\r\n\r\n        --変更後枝番２\r\n        RJUSHOHENKO_JKN_ERR.AF_EDABAN2 := SUBSTR(VAF_EDABAN2,1,10);\r\n\r\n        --変更後枝番３\r\n        RJUSHOHENKO_JKN_ERR.AF_EDABAN3 := SUBSTR(VAF_EDABAN3,1,10);\r\n\r\n        --変更後番地編集タイプ\r\n        RJUSHOHENKO_JKN_ERR.AF_BANCHI_HENSHU_TYPE := SUBSTR(VAF_BANCHI_HENSHU_TYPE,1,10);\r\n\r\n        --変更後郵便番号\r\n        RJUSHOHENKO_JKN_ERR.AF_YUBIN_NO := SUBSTR(VAF_YUBIN_NO,1,20);\r\n\r\n        --支所コード\r\n        RJUSHOHENKO_JKN_ERR.SHISHO_CD := SUBSTR(VSHISHO_CD,1,10);\r\n\r\n        --地区コード\r\n        RJUSHOHENKO_JKN_ERR.CHIKU_CD := SUBSTR(VCHIKU_CD,1,10);\r\n\r\n        --行政区コード\r\n        RJUSHOHENKO_JKN_ERR.GYOSEIKU_CD := SUBSTR(VGYOSEIKU_CD,1,10);\r\n\r\n        --班コード\r\n        RJUSHOHENKO_JKN_ERR.HAN_CD := SUBSTR(VHAN_CD,1,20);\r\n\r\n        --小学校コード\r\n        RJUSHOHENKO_JKN_ERR.SHOGAKU_CD := SUBSTR(VSHOGAKU_CD,1,10);\r\n\r\n        --中学校コード\r\n        RJUSHOHENKO_JKN_ERR.CHUGAKU_CD := SUBSTR(VCHUGAKU_CD,1,10);\r\n\r\n        --投票区コード\r\n        RJUSHOHENKO_JKN_ERR.TOHYOKU_CD := SUBSTR(VTOHYOKU_CD,1,10);\r\n\r\n        --ごみ業者コード\r\n        RJUSHOHENKO_JKN_ERR.GOMI_CD := SUBSTR(VGOMI_CD,1,10);\r\n\r\n        --し尿業者コード\r\n        RJUSHOHENKO_JKN_ERR.SINYO_CD := SUBSTR(VSINYO_CD,1,10);\r\n\r\n        --作成日\r\n        RJUSHOHENKO_JKN_ERR.SYS_SAKUSEIBI := i_NSHORIBI;\r\n\r\n        --更新日\r\n        RJUSHOHENKO_JKN_ERR.SYS_KOSHINBI := 0;\r\n\r\n        --更新時間\r\n        RJUSHOHENKO_JKN_ERR.SYS_JIKAN := TO_CHAR(SYSDATE, 'HH24MISS');\r\n\r\n        --更新職員個人番号\r\n        RJUSHOHENKO_JKN_ERR.SYS_SHOKUINKOJIN_NO := i_NSHOKUIN_NO;\r\n\r\n        --更新端末番号\r\n        RJUSHOHENKO_JKN_ERR.SYS_TANMATSU_NO := i_VMACHINE_NAME;\r\n\r\n        BEGIN\r\n          INSERT INTO JIBTJUSHOHENKO_JKN_ERR VALUES RJUSHOHENKO_JKN_ERR;\r\n          NERRDATACOUNT := NERRDATACOUNT + 1;\r\n          NERRORFLG := 1;\r\n        EXCEPTION\r\n          WHEN OTHERS THEN\r\n            ROLLBACK;\r\n            -- SQL情報取得\r\n            o_NSQL_CODE := c_INOT_SUCCESS;\r\n            o_VSQL_MSG  := SUBSTR(TO_CHAR(SQLERRM),1,255);\r\n            RETURN;\r\n        END;\r\n      END IF;\r\n    END IF;\r\n\r\n    NCOUNT                         := NCOUNT + 1;\r\n    -- 最後一行データがない場合\r\n    IF NINDEX <> 0 THEN\r\n      NBAK_INDEX                   := NINDEX;\r\n    END IF;\r\n    NINDEX                         := DBMS_LOB.INSTR(RCFD_FILE.DATA,UTL_RAW.CAST_TO_RAW(CHR(13)),1,NCOUNT);\r\n    NAMOUNT                        := NINDEX - NOFFSET;\r\n    END LOOP;\r\n  END LOOP;\r\n\r\n  COMMIT;\r\n\r\n  -- データを抽出しない場合、-1をo_NSQLCODEにセットする。\r\n  IF NERRORFLG = 1 THEN\r\n    o_NSQL_CODE   := c_INOT_SUCCESS;\r\n  ELSE\r\n    o_NSQL_CODE   := c_ISUCCESS;\r\n  END IF;\r\n\r\n  EXCEPTION\r\n  /* その他エラー */\r\n  WHEN OTHERS THEN\r\n    ROLLBACK;\r\n    -- SQL情報取得\r\n    o_NSQL_CODE := c_INOT_SUCCESS;\r\n    o_VSQL_MSG  := SUBSTR(TO_CHAR(SQLERRM),1,255);\r\nEND;\r\n/\n\n--- GENERATED WIKI ---\n# 📄 JIBSOJHJKNCHK 过程技术文档  \r\n**文件路径**：`[JIBSOJHJKNCHK.SQL](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL)`\r\n\r\n> **阅读对象**：刚接手 JIB（住民记录）模块的开发者  \r\n> **核心疑惑**：  \r\n> 1️⃣ 这段过程到底在做什么？  \r\n> 2️⃣ 如何在现有系统中安全地修改或扩展它？\r\n\r\n下面的文档围绕这两个疑问组织，帮助你快速定位、理解并维护代码。\r\n\r\n---\r\n\r\n## 1️⃣ 概要概述\r\n\r\n| 项目 | 内容 |\r\n|------|------|\r\n| **业务名称** | JIB（住民记录） |\r\n| **过程名** | `JIBSOJHJKNCHK` |\r\n| **功能** | 读取临时表 `JIBWJUSHOHENKO_TMP` 中的 **住居表示変更条件 FD** 数据，逐行进行 **格式、必填、代码映射、关联性** 检查。<br>✔ 检查通过 → 写入工作表 `JIBWJUSHOHENKO_KEY`（用于后续同番检查）<br>❌ 检查不通过 → 写入错误表 `JIBTJUSHOHENKO_JKN_ERR` 并记录错误标识 |\r\n| **输入参数** | - `i_NSHORIBI`（处理日）<br>- `i_VMACHINE_NAME`（端末编号）<br>- `i_NSHOKUIN_NO`（操作员个人编号） |\r\n| **输出参数** | - `o_NSQL_CODE`（过程执行状态）<br>- `o_VSQL_MSG`（错误信息） |\r\n| **调用链** | 由上层批处理或 UI 调用，通常在 **住居表示変更** 业务的“导入校验”阶段执行。 |\r\n\r\n> **为什么要这样做？**  \r\n> - **临时表** 用来缓存外部系统（如 CSV）导入的原始数据，避免直接写入正式表导致脏数据。  \r\n> - **错误表** 记录每条记录的错误码，供后续 UI 报表或手工修正使用。  \r\n> - **工作表** 保存通过校验的唯一键组合，用于 **同番检查**（防止同一地址出现多条记录）。\r\n\r\n---\r\n\r\n## 2️⃣ 代码级洞察\r\n\r\n### 2.1 关键常量 & 变量\r\n\r\n| 常量 | 含义 |\r\n|------|------|\r\n| `c_ISUCCESS` | 正常结束（0） |\r\n| `c_INOT_SUCCESS` | 异常结束（-1） |\r\n| `c_IRETNG` | 业务返回码 1 |\r\n| `c_VTABLE` / `c_VTABLE1` | 错误表 & 工作表名称 |\r\n| `I_JICHI_KBN` | 旧自治体区分（固定 1） |\r\n\r\n> **变量** 大量以 `V...`（原始字段值）和 `RJUSHOHENKO_JKN_ERR`（错误记录行）命名，遵循 **“V 前缀 = 原始值，RJ... = 错误行结构体”** 的约定。\r\n\r\n### 2.2 过程结构（高层流程）\r\n\r\n```mermaid\r\nflowchart TD\r\n    A[\"初始化\"] --> B[\"清空错误表 & 工作表\"]\r\n    B --> C[\"读取控制参数\"]\r\n    C --> D[\"遍历临时表 (CFD_FILE)\"]\r\n    D --> E[\"逐行解析 CSV\"]\r\n    E --> F[\"字段逐项校验\"]\r\n    F --> G{\"全部通过?\"}\r\n    G -->|\"是\"| H[\"写入工作表 (同番检查用)\"]\r\n    G -->|\"否\"| I[\"写入错误表\"]\r\n    H --> J[\"继续下一行\"]\r\n    I --> J\r\n    J --> K{\"还有行?\"}\r\n    K -->|\"是\"| D\r\n    K -->|\"否\"| L[\"提交 COMMIT\"]\r\n    L --> M[\"返回状态\"]\r\n```\r\n\r\n### 2.3 关键子程序（函数/过程）  \r\n\r\n| 名称 | 类型 | 作用 | Wiki 链接 |\r\n|------|------|------|-----------|\r\n| `EBPFCHKNUMERIC` | Function | 判断字符串是否全为数字，返回 `TRUE`（合法）并通过 `o_ISNULL` 标记空值 | [`EBPFCHKNUMERIC`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKNUMERIC) |\r\n| `EBPFCHKIKETASU` | Function | 检查字符串长度是否 ≤ 指定上限 | [`EBPFCHKIKETASU`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKIKETASU) |\r\n| `EBPFCHKCDHENKOU` | Function | 依据 `GABTGYOSEIJOHO` 表验证 **行政区代码** 是否存在 | [`EBPFCHKCDHENKOU`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKCDHENKOU) |\r\n| `EBPFCHKCDHENKOU1` | Function | 依据 `KKATCD` 表验证 **垃圾/污水业者代码** 是否存在 | [`EBPFCHKCDHENKOU1`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKCDHENKOU1) |\r\n| `EBPFCHKSONOTA` | Function | 检查 **同番工作表** 中是否已存在相同地址组合 | [`EBPFCHKSONOTA`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKSONOTA) |\r\n| `EBPFTOONAJIBANCHK` | Procedure | 若前置检查均通过，调用 `EBPFCHKSONOTA` 并在错误记录中追加 **同番** 标记 `$` | [`EBPFTOONAJIBANCHK`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFTOONAJIBANCHK) |\r\n| `PROCCLEAR` | Procedure | 将错误记录结构体的所有错误字段清空（为每行校验做准备） | [`PROCCLEAR`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#PROCCLEAR) |\r\n\r\n> **实现权衡**：  \r\n> - **函数返回布尔** + **错误码拼接**（`*`, `&`, `#`, `@`, `%`, `$`）的方式极大提升了 **单行错误聚合** 的可读性，但也导致代码行数膨胀。  \r\n> - 所有校验均在 PL/SQL 中完成，避免了在外层程序中重复实现，保持业务统一。\r\n\r\n### 2.4 逐字段校验要点（示例）\r\n\r\n| 字段 | 校验顺序 | 错误标识 | 关键代码片段 |\r\n|------|----------|----------|--------------|\r\n| `BF_CITY_CD`（前置市区町村代码） | 1️⃣ 数字检查 → 2️⃣ 长度 ≤5 → 3️⃣ 必填 → 4️⃣ 代码映射（`GABTGYOSEIJOHO`） | `EBPFCHKNUMERIC` → `EBPFCHKIKETASU` → `EBPFCHKCDHENKOU` |\r\n| `BF_BANCHI_HENSHU_TYPE`（地址编辑类型） | 同上 + **必填** → **关联检查**（若编辑类型 >20 必须有 `EDABAN1`，>30 必须有 `EDABAN2`，>40 必须有 `EDABAN3`） | 关联检查代码位于 `--BF_BANCHI_HENSHU_TYPEその他チェック` 块 |\r\n| `SHISHO_CD`（支所代码） | 必填受 `CTLPRM9` 控制 → 代码映射 `KKATCD`（业务代码 001） | 代码块 `--支所コード` |\r\n| `VCHIKU_CD`（地区代码） | 必填受 `CTLPRM2` 控制 → 代码映射 `EBPFCHKCDHENKOU`（业务码 1） | 代码块 `--地区コード` |\r\n| **关联性检查**（如 `BF_EDABAN1` 必须在 `BF_HONBAN` 不为空时出现） | 通过布尔 `W_ERRFLG` 记录是否需要在错误字段追加 `%` | 代码块 `--BF_EDABAN1その他チェック`、`--BF_EDABAN2その他チェック`、`--BF_EDABAN3その他チェック` |\r\n\r\n> **错误标识约定**（会在错误表的对应字段中出现）  \r\n> - `*` → 非数字  \r\n> - `&` → 长度超限  \r\n> - `#` → 必填缺失  \r\n> - `@` → 代码映射不存在  \r\n> - `%` → 关联性错误（如枝番缺失）  \r\n> - `$` → 同番冲突  \r\n\r\n### 2.4 关键业务逻辑细节\r\n\r\n1. **控制参数读取**  \r\n   ```plsql\r\n   RTN := KKAPK0030.FPRMSHUTOKU('JIB','00JHGYOSEIJOHO','0',TACONSPRM,NPRM_LENGTH);\r\n   ```\r\n   - 读取 9 条业务开关（`CTLPRM1~9`），决定哪些字段是 **必填**、是否进行 **行政信息自动填充** 等。  \r\n   - 若读取失败，所有开关默认 `0`（不检查）。\r\n\r\n2. **CSV 解析**  \r\n   - 临时表的 `DATA` 为 **BLOB**（UTF‑8 编码的 CSV）。  \r\n   - 通过 `DBMS_LOB.INSTR` 与 `CHR(13)`（回车）定位每行，使用 `UTL_RAW.CAST_TO_VARCHAR2` 转为字符。  \r\n   - 解析顺序严格对应 **住居表示変更条件 FD** 的 26 列（从 `BF_CITY_CD` 到 `VSINYO_CD`），每列后追加 **固定占位** `',,,,,,,,,,,,,,......'` 防止缺列导致 `INSTR` 失效。\r\n\r\n3. **字段校验**（循环体内部）  \r\n   - **数值校验** → `EBPFCHKNUMERIC`  \r\n   - **长度校验** → `EBPFCHKIKETASU`  \r\n   - **必填校验** → `BOUT_ISNULL` 与 `CTLPRMx` 组合决定是否追加 `#`  \r\n   - **代码映射** → `EBPFCHKCDHENKOU` / `EBPFCHKCDHENKOU1`  \r\n   - **关联性检查** → 通过一系列 `IF … THEN …` 语句实现（如枝番必须在本番存在时才允许）。  \r\n\r\n4. **错误聚合**  \r\n   - 每个字段的错误标识直接 **拼接** 到对应错误字段（如 `BF_CITY_CD_ERR := '*&#@'`）。  \r\n   - 最后统一把 **同番冲突**（`$`）加入错误记录（`EBPFTOONAJIBANCHK`）。\r\n\r\n5. **写入目标**  \r\n   - **全部通过** → `INSERT INTO JIBWJUSHOHENKO_KEY`（工作表）  \r\n   - **任意错误** → `INSERT INTO JIBTJUSHOHENKO_JKN_ERR`（错误表），并记录 `ERRFLG`（聚合错误码，最多 10 个字符）  \r\n\r\n6. **事务控制**  \r\n   - **每行** 的 `INSERT` 均在 `BEGIN … EXCEPTION … END` 块中捕获异常，出现异常时 `ROLLBACK` 并直接返回错误码。  \r\n   - 循环结束后统一 `COMMIT`，确保 **导入批次** 原子化。\r\n\r\n---\r\n\r\n## 3️⃣ 依赖关系与关联模块\r\n\r\n| 依赖对象 | 类型 | 说明 |\r\n|----------|------|------|\r\n| `JIBWJUSHOHENKO_TMP` | 临时表 | 外部 CSV 导入后由 **批处理** 填充的原始数据 |\r\n| `JIBTJUSHOHENKO_JKN_ERR` | 错误表 | 记录每条校验失败的错误码，供 UI 报表或手工修正 |\r\n| `JIBWJUSHOHENKO_KEY` | 工作表 | 保存通过校验的唯一键组合，用于 **同番检查**（防止同一地址出现多条记录） |\r\n| `GABTGYOSEIJOHO`、`GABTSHIKUCHOSON`、`GABTOAZA`、`KKATCD` | 代码映射表 | 各类行政区、业者、支所等代码的主数据来源 |\r\n| `KKAPK0030.FPRMSHUTOKU`、`KKAPK3000.FTRUNCATE` | 公共库过程 | 读取业务参数、清空表的通用工具 |\r\n| `JIBSKGYOSEGET`（外部过程） | Procedure | 根据地址信息自动获取行政信息（如 `GYOSEIKU_CD`、`HAN_CD` 等），在 **关联性检查** 中被调用 |\r\n| `A_CONS_PRM`、`JIBTJUSHOHENKO_JKN_ERR%ROWTYPE`、`JIBWJUSHOHENKO_KEY%ROWTYPE` | PL/SQL 记录类型 | 用来存放控制参数、错误记录、工作表记录的结构体 |\r\n\r\n> **设计动机**：所有校验均在同一个 PL/SQL 过程里完成，保持 **一次导入一次校验** 的事务一致性，避免业务层面多次往返数据库。\r\n\r\n---\r\n\r\n## 4️⃣ 关键业务规则（开发者必读）\r\n\r\n| 规则编号 | 触发条件 | 结果 | 关联字段 |\r\n|----------|----------|------|----------|\r\n| **R01** | 任意字段非数字 | 错误标记 `*` 加到对应 `*_ERR` 列 | `EBPFCHKNUMERIC` |\r\n| **R02** | 字符串长度 > 设定上限 | 错误标记 `&` | `EBPFCHKIKETASU` |\r\n| **R03** | 必填字段为空（受 `CTLPRMx` 控制） | 错误标记 `#` | `PROCCLEAR` → `BOUT_ISNULL` |\r\n| **R04** | 代码映射表未找到对应记录 | 错误标记 `@` | `EBPFCHKCDHENKOU` / `EBPFCHKCDHENKOU1` |\r\n| **R05** | 关联性错误（如枝番出现但本番缺失） | 错误标记 `%` | 多段 `IF … THEN …` 逻辑 |\r\n| **R06** | 同番冲突（已在 `JIBWJUSHOHENKO_KEY` 中出现相同地址组合） | 错误标记 `$`（在 `EBPFTOONAJIBANCHK` 中追加） | `EBPFCHKSONOTA` |\r\n| **R07** | 所有检查均通过 | 写入 `JIBWJUSHOHENKO_KEY`，**不写错误表** | `INSERT INTO JIBWJUSHOHENKO_KEY` |\r\n| **R08** | 任意检查失败 | 写入 `JIBTJUSHOHENKO_JKN_ERR`，`ERRFLG` 聚合所有错误码（最多 10） | `INSERT INTO JIBTJUSHOHENKO_JKN_ERR` |\r\n\r\n> **扩展提示**：如果业务需要新增字段，只需在 **字段逐项校验** 区块中复制现有模式（数值 → 长度 → 必填 → 代码映射 → 关联检查），并在错误结构体中添加对应 `*_ERR` 列。\r\n\r\n---\r\n\r\n## 5️⃣ 常见维护场景 & 建议\r\n\r\n| 场景 | 可能的改动 | 风险点 | 推荐做法 |\r\n|------|------------|--------|----------|\r\n| **新增字段**（如 “住宅类型”） | - 在 `PROCCLEAR` 中添加对应错误字段<br>- 在 CSV 解析段加入 `V...` 读取<br>- 添加数值/长度/必填/代码映射检查 | ① 可能破坏现有 CSV 列位置的硬编码；② 错误表结构不匹配导致 `INSERT` 失败 | 1️⃣ 先在 `JIBWJUSHOHENKO_TMP` 添加新列（保持顺序）<br>2️⃣ 在错误表 `JIBTJUSHOHENKO_JKN_ERR` 增加 `..._ERR` 列<br>3️⃣ 按 **R01–R04** 规则在 `F[字段逐项校验]` 中加入新字段的检查 |\r\n| **修改必填规则**（如把 `VSHISHO_CD` 改为非必填） | 调整对应 `CTLPRMx` 参数的读取或直接在代码中改 `IF … THEN …` 条件 | 业务参数表 `JIBWJUSHOHENKO_PRM`（由 `KKAPK0030.FPRMSHUTOKU` 读取）可能被其他过程共享 | 通过 **控制参数**（`CTLPRM9`）实现，建议在 **业务参数表** 中修改，而不是硬编码 |\r\n| **优化性能**（大批量 CSV） | - 将 `INSERT` 改为 **批量插入**（`FORALL`）<br>- 减少 `SELECT COUNT(*)` 的频繁调用（改为缓存或索引） | 过程内部大量 `SELECT COUNT(*)`（代码映射、同番检查）会导致 **行级锁** 与 **IO 瓶颈** | 1️⃣ 为 `GABTGYOSEIJOHO`、`KKATCD`、`JIBWJUSHOHENKO_KEY` 添加合适的 **索引**（如 `CITY_CD`、`KEY` 组合）<br>2️⃣ 若数据量 > 10 万行，考虑 **分批提交**（每 5k 行 `COMMIT`）并在外层捕获异常 |\r\n\r\n---\r\n\r\n## 6️⃣ 参考实现细节（代码片段）\r\n\r\n### 6.1 `EBPFCHKNUMERIC`（数值检查）\r\n\r\n```plsql\r\nFUNCTION EBPFCHKNUMERIC(i_VCHAR IN NVARCHAR2, o_ISNULL OUT BOOLEAN) RETURN BOOLEAN IS\r\n  BRTN BOOLEAN;\r\nBEGIN\r\n  o_ISNULL := FALSE;\r\n  IF i_VCHAR IS NULL THEN\r\n    BRTN := FALSE;\r\n    o_ISNULL := TRUE;\r\n  ELSIF TRIM(TRANSLATE(i_VCHAR,'0123456789','          ')) IS NULL THEN\r\n    BRTN := TRUE;\r\n  ELSE\r\n    BRTN := FALSE;\r\n  END IF;\r\n  RETURN BRTN;\r\nEND EBPFCHKNUMERIC;\r\n```\r\n\r\n> **解释**：  \r\n> - `TRANSLATE` 把所有数字字符映射为空格，若结果全为空则说明原串全为数字。  \r\n> - `o_ISNULL` 用来区分 “空值” 与 “非数字”。  \r\n\r\n---\r\n\r\n### 6.2 `EBPFCHKIKETASU`（长度检查）\r\n\r\n```plsql\r\nFUNCTION EBPFCHKIKETASU(i_VCHAR IN NVARCHAR2,i_IKETASU IN PLS_INTEGER) RETURN BOOLEAN IS\r\n  BRTN BOOLEAN;\r\nBEGIN\r\n  IF i_IKETASU <> 0 THEN\r\n    IF ( LENGTH(i_VCHAR) > i_IKETASU ) THEN\r\n      BRTN := FALSE;\r\n    ELSE\r\n      BRTN := TRUE;\r\n    END IF;\r\n  END IF;\r\n  RETURN BRTN;\r\nEND EBPFCHKIKETASU;\r\n```\r\n\r\n> **解释**：只要 `i_IKETASU` 为非 0，就比较实际长度是否超出上限。\r\n\r\n---\r\n\r\n### 6.3 `EBPFCHKCDHENKOU`（行政区代码映射）\r\n\r\n```plsql\r\nFUNCTION EBPFCHKCDHENKOU(i_VCHAR  IN NVARCHAR2,i_NKEN  IN NUMBER) RETURN NUMBER IS\r\n  NSQL_COUNT NUMBER;\r\nBEGIN\r\n  SELECT COUNT(*)\r\n    INTO NSQL_COUNT\r\n    FROM GABTGYOSEIJOHO\r\n   WHERE GYOSEI_JOHO_CD = i_VCHAR\r\n     AND GYOSEI_JOHO_KBN=i_NKEN\r\n     AND KYU_JICHITAI_KBN=1;\r\n  RETURN NSQL_COUNT;\r\nEXCEPTION\r\n  WHEN NO_DATA_FOUND THEN NSQL_COUNT := 0;\r\n  WHEN OTHERS THEN NSQL_COUNT := 0;\r\n  RETURN NSQL_COUNT;\r\nEND EBPFCHKCDHENKOU;\r\n```\r\n\r\n> **解释**：返回匹配记录数，`0` 表示 **代码不存在** → 错误标记 `@`。\r\n\r\n---\r\n\r\n### 6.4 `PROCCLEAR`（错误结构体清空）\r\n\r\n```plsql\r\nPROCEDURE PROCCLEAR IS\r\nBEGIN\r\n  RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR            := '';\r\n  RJUSHOHENKO_JKN_ERR.BF_JICHI_CD_ERR           := '';\r\n  ...\r\n  RJUSHOHENKO_JKN_ERR.SINYO_CD_ERR              := '';\r\nEND PROCCLEAR;\r\n```\r\n\r\n> **作用**：每处理一行前，先把错误行结构体的所有错误字段置空，防止上一次循环的错误残留。\r\n\r\n---\r\n\r\n### 6.5 `EBPFTOONAJIBANCHK`（同番检查）\r\n\r\n```plsql\r\nPROCEDURE EBPFTOONAJIBANCHK(i_BFCITYCD IN NVARCHAR2,i_BFOAZACD IN NVARCHAR2,\r\n                             i_BFHONBAN IN NVARCHAR2,i_BFEDABAN1 IN NVARCHAR2,\r\n                             i_BFEDABAN2 IN NVARCHAR2,i_BFEDABAN3 IN NVARCHAR2) IS\r\n  V_BFEDABAN1   NVARCHAR2(20);\r\n  V_BFEDABAN2   NVARCHAR2(20);\r\n  V_BFEDABAN3   NVARCHAR2(20);\r\nBEGIN\r\n  ...  -- 处理空值 → 0\r\n  NSQLCOUNT := EBPFCHKSONOTA(i_BFCITYCD , i_BFOAZACD , i_BFHONBAN , V_BFEDABAN1 , V_BFEDABAN2 , V_BFEDABAN3);\r\n  IF NSQLCOUNT > 0 THEN\r\n    RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR := RJUSHOHENKO_JKN_ERR.BF_CITY_CD_ERR || '$';\r\n    ...\r\n  END IF;\r\nEND EBPFTOONAJIBANCHK;\r\n```\r\n\r\n> **关键点**：同番冲突只在 **所有前置校验均通过** 时才进行，错误标记 `$` 会在最终错误记录的 `ERRFLG` 中出现。\r\n\r\n---\r\n\r\n## 7️⃣ 维护建议 & 常见坑\r\n\r\n| 场景 | 可能的错误 | 检查点 |\r\n|------|------------|--------|\r\n| **字段顺序变动** | CSV 列顺序与代码硬编码不匹配 → 解析错误、字段错位 | 确认 `CFD_FILE` 中的 `DATA` 列顺序与 **过程内部的 26 次 `NPOINT` 切割** 完全对应 |\r\n| **控制参数缺失** | `KKAPK0030.FPRMSHUTOKU` 返回 `NULL` → 所有 `CTLPRMx` 为 `0`（默认不检查） | 查看 `JIBWJUSHOHENKO_PRM` 表的对应记录是否存在 |\r\n| **代码映射表结构变更** | `GABTGYOSEIJOHO`、`KKATCD` 增删列 → `SELECT COUNT(*)` 失效 | 确认映射表的 **主键** 与过程使用的列保持一致（`GYOSEI_JOHO_CD`、`ANYCODE` 等） |\r\n| **错误表结构不匹配** | 新增错误字段但忘记在 `PROCCLEAR` 与错误写入块中同步 | 每次 **新增错误码** 必须在 `PROCCLEAR`、错误拼接（`||`）以及 `INSERT` 语句中全部补全 |\r\n| **大批量导入导致超时** | LOB 循环每行单独 `INSERT`，事务日志膨胀 | 考虑 **分批提交**（每 5k 行 `COMMIT`）或使用 `FORALL` 批量插入（需要重构） |\r\n\r\n---\r\n\r\n## 8️⃣ 扩展思路（如果业务要新增功能）\r\n\r\n1. **新增字段**（如 “住宅类型”）  \r\n   - 在 `JIBWJUSHOHENKO_TMP`、`JIBTJUSHOHENKO_JKN_ERR`、`JIBWJUSHOHENKO_KEY` 中同步列。  \r\n   - 在 **字段逐项校验** 区块复制现有模式（数值 → 长度 → 必填 → 代码映射）。  \r\n   - 在 `PROCCLEAR` 中加入对应错误字段的清空语句。  \r\n\r\n2. **改为批量提交**  \r\n   - 将 `INSERT INTO JIBWJUSHOHENKO_KEY` 与 `INSERT INTO JIBTJUSHOHENKO_JKN_ERR` 改写为 `FORALL` + `SAVE EXCEPTIONS`，在循环外统一 `COMMIT`。  \r\n   - 需要在 PL/SQL 中声明集合（`TABLE OF ... INDEX BY PLS_INTEGER`），并在循环中 `EXTEND` 填充。  \r\n\r\n3. **把控制参数抽象为配置文件**  \r\n   - 当前使用 `KKAPK0030.FPRMSHUTOKU` 读取硬编码的 9 条开关。若业务经常变动，可改为 **JSON 配置表**，在过程开始时一次性 `SELECT` 并解析为 PL/SQL 记录。  \r\n\r\n---\r\n\r\n## 9️⃣ 参考文献（内部链接）\r\n\r\n- **函数**  \r\n  - [`EBPFCHKNUMERIC`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKNUMERIC)  \r\n  - [`EBPFCHKIKETASU`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKIKETASU)  \r\n  - [`EBPFCHKCDHENKOU`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKCDHENKOU)  \r\n  - [`EBPFCHKCDHENKOU1`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKCDHENKOU1)  \r\n  - [`EBPFCHKSONOTA`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFCHKSONOTA)  \r\n\r\n- **过程**  \r\n  - [`EBPFTOONAJIBANCHK`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#EBPFTOONAJIBANCHK)  \r\n  - [`PROCCLEAR`](http://localhost:3000/projects/JIP/wiki?file_path=D:/code-wiki/projects/JIP/JIBSRC/JIBSOJHJKNCHK.SQL#PROCCLEAR)  \r\n\r\n- **外部依赖**  \r\n  - `KKAPK3000.FTRUNCATE`（表清空）  \r\n  - `KKAPK0030.FPRMSHUTOKU`（业务参数读取）  \r\n  - `JIBSKGYOSEGET`（地址自动行政信息获取）  \r\n\r\n---\r\n\r\n## 📌 小结\r\n\r\n- **核心职责**：一次性 **校验**、**分流**（合法 → 同番工作表，非法 → 错误表），确保住居表示変更数据的完整性。  \r\n- **维护要点**：  \r\n  1️⃣ 任何字段的校验顺序、错误标识拼接方式都严格遵循 **`* & # @ % $`** 约定。  \r\n  2️⃣ 若要新增字段或修改必填规则，优先在 **控制参数**（`CTLPRMx`）中完成，而不是硬编码。  \r\n  3️⃣ 大批量导入时注意 **事务大小** 与 **索引**，必要时引入 **分批提交** 或 **FORALL** 批量写入。  \r\n\r\n祝你在 JIB 模块的维护与升级中顺利！如果还有更细节的疑问，随时在 Wiki 中搜索对应函数或过程名，或在项目的 **技术讨论区** 提问。 🚀\n\nCRITICAL RULES:\n- Extract ONLY objective, verifiable facts\n- DO NOT evaluate quality\n- DO NOT assign scores\n- DO NOT summarize\n- DO NOT judge usefulness\n- DO NOT say good/bad/correct/incorrect\n- ONLY list concrete missing, mismatched, or hallucinated items\n\nREQUIRED OUTPUT (VALID JSON ONLY):\n\n{\n  \"coverage\": {\n    \"total_items\": <integer>,\n    \"covered_items\": <integer>,\n    \"missing\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what is missing>\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": <integer>,\n    \"mismatches\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what does not match the source>\"\n      }\n    ]\n  },\n  \"hallucination\": [\n    {\n      \"position\": <integer>,\n      \"content\": \"<invented object or behavior>\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<important concept not explained>\"\n      }\n    ]\n  }\n}\n",
          "label": "You are a FACT EXTRACTION ENGINE.\n\nYou are given:\n- SOURCE CODE (Java or SQL)\n- GENERATED WIKI (Markdown)\n\n--- SOURCE CODE ---\n{{source_code}}\n\n--- GENERATED WIKI ---\n{{wiki_md}}\n\nCRITICAL RULES:\n- Extract ONLY objective, verifiable facts\n- DO NOT evaluate quality\n- DO NOT assign scores\n- DO NOT summarize\n- DO NOT judge usefulness\n- DO NOT say good/bad/correct/incorrect\n- ONLY list concrete missing, mismatched, or hallucinated items\n\nREQUIRED OUTPUT (VALID JSON ONLY):\n\n{\n  \"coverage\": {\n    \"total_items\": <integer>,\n    \"covered_items\": <integer>,\n    \"missing\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what is missing>\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": <integer>,\n    \"mismatches\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what does not match the source>\"\n      }\n    ]\n  },\n  \"hallucination\": [\n    {\n      \"position\": <integer>,\n      \"content\": \"<invented object or behavior>\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<important concept not explained>\"\n      }\n    ]\n  }\n}\n",
          "config": {}
        },
        "promptId": "d67930fce9ba3d75cb987b51ea04eff664d2aabc2c711e2e3421ecdfb4e654e6",
        "promptIdx": 0,
        "provider": {
          "id": "ollama:gpt-oss:120b",
          "label": ""
        },
        "response": {
          "output": "{\n  \"coverage\": {\n    \"total_items\": 62,\n    \"covered_items\": 48,\n    \"missing\": [\n      {\n        \"position\": 1,\n        \"content\": \"Constant `c_IRETNG` is defined but not described in the wiki.\"\n      },\n      {\n        \"position\": 2,\n        \"content\": \"Constant `I_JICHI_KBN` (old自治体区分) is defined but not mentioned.\"\n      },\n      {\n        \"position\": 3,\n        \"content\": \"Cursor `CFD_FILE` definition and its purpose are omitted.\"\n      },\n      {\n        \"position\": 4,\n        \"content\": \"Variables `NCOUNT`, `NPOINT`, `NENTER_POINT`, `NUM`, `NDATACOUNT`, `NERRDATACOUNT`, `NERRORFLG`, `NBAK_INDEX`, `NBLOB_BUFFER`, `NOFFSET`, `BRET`, `BOUT_ISNULL`, `NSQLCOUNT`, `NJOKEN`, `W_ERRFLG`, `W_ERRFLG1`, `W_ERRFLG2`, `V_ERRFLG`, `BKIGOUFLG1‑6`, `nRTN` are declared in the source but not explained.\"\n      },\n      {\n        \"position\": 5,\n        \"content\": \"The meaning and usage of control parameters `CTLPRM1`‑`CTLPRM9` are not detailed.\"\n      },\n      {\n        \"position\": 6,\n        \"content\": \"The logic that appends a long string of commas to `VDATA` (`,,,,......`) is not explained.\"\n      },\n      {\n        \"position\": 7,\n        \"content\": \"The handling of NULL values for address fields (e.g., converting NULL to 0) is not described.\"\n      },\n      {\n        \"position\": 8,\n        \"content\": \"The detailed error‑flag aggregation using `BKIGOUFLG1`‑`BKIGOUFLG6` and the construction of `ERRFLG` is omitted.\"\n      },\n      {\n        \"position\": 9,\n        \"content\": \"The exact mapping of error symbols (`*`, `&`, `#`, `@`, `%`, `$`) to validation steps is only partially covered; the wiki does not explain that `*` = non‑numeric, `&` = length overflow, `#` = required missing, `@` = code not found, `%` = correlation error, `$` = duplicate key.\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": 0,\n    \"mismatches\": []\n  },\n  \"hallucination\": [\n    {\n      \"position\": 1,\n      \"content\": \"The wiki includes fabricated URLs such as `http://localhost:3000/projects/JIP/wiki?...` which do not exist in the source code.\"\n    },\n    {\n      \"position\": 2,\n      \"content\": \"Reference to a non‑existent table `JIBWJUSHOHENKO_PRM` as the source of control parameters.\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": 1,\n        \"content\": \"Explanation of what each control parameter (`CTLPRM1`‑`CTLPRM9`) actually controls (e.g., which fields become mandatory).\"\n      },\n      {\n        \"position\": 2,\n        \"content\": \"Purpose of the `CFD_FILE` cursor and why the procedure reads from `JIBWJUSHOHENKO_TMP`.\"\n      },\n      {\n        \"position\": 3,\n        \"content\": \"Reason for appending a large number of commas to `VDATA` before parsing.\"\n      },\n      {\n        \"position\": 4,\n        \"content\": \"Detailed description of the error‑flag aggregation algorithm (`BKIGOUFLG` variables) and how `ERRFLG` is built.\"\n      },\n      {\n        \"position\": 5,\n        \"content\": \"Why certain address components are coerced to `0` when NULL and how that affects later checks.\"\n      },\n      {\n        \"position\": 6,\n        \"content\": \"Meaning of the constant `I_JICHI_KBN` and its role in the call to `JIBSKGYOSEGET`.\"\n      }\n    ]\n  }\n}",
          "tokenUsage": {
            "prompt": 28961,
            "completion": 1702,
            "total": 30663
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "name": "Stage1 Fact Extraction",
          "vars": {
            "source_code": "file://data\\JIBSOJHJKNCHK.utf8.SQL",
            "wiki_md": "file://data\\JIBSOJHJKNCHK.SQL.md"
          },
          "assert": [],
          "options": {},
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "source_code": "file://data\\JIBSOJHJKNCHK.utf8.SQL",
          "wiki_md": "file://data\\JIBSOJHJKNCHK.SQL.md"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      }
    ],
    "stats": {
      "successes": 1,
      "failures": 0,
      "errors": 0,
      "tokenUsage": {
        "prompt": 28961,
        "completion": 1702,
        "cached": 0,
        "total": 30663,
        "numRequests": 1,
        "completionDetails": {
          "reasoning": 0,
          "acceptedPrediction": 0,
          "rejectedPrediction": 0
        },
        "assertions": {
          "total": 0,
          "prompt": 0,
          "completion": 0,
          "cached": 0,
          "numRequests": 0,
          "completionDetails": {
            "reasoning": 0,
            "acceptedPrediction": 0,
            "rejectedPrediction": 0
          }
        }
      },
      "durationMs": 25996
    }
  },
  "config": {
    "tags": {},
    "prompts": [
      "You are a FACT EXTRACTION ENGINE.\n\nYou are given:\n- SOURCE CODE (Java or SQL)\n- GENERATED WIKI (Markdown)\n\n--- SOURCE CODE ---\n{{source_code}}\n\n--- GENERATED WIKI ---\n{{wiki_md}}\n\nCRITICAL RULES:\n- Extract ONLY objective, verifiable facts\n- DO NOT evaluate quality\n- DO NOT assign scores\n- DO NOT summarize\n- DO NOT judge usefulness\n- DO NOT say good/bad/correct/incorrect\n- ONLY list concrete missing, mismatched, or hallucinated items\n\nREQUIRED OUTPUT (VALID JSON ONLY):\n\n{\n  \"coverage\": {\n    \"total_items\": <integer>,\n    \"covered_items\": <integer>,\n    \"missing\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what is missing>\"\n      }\n    ]\n  },\n  \"correctness\": {\n    \"wrong_count\": <integer>,\n    \"mismatches\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<what does not match the source>\"\n      }\n    ]\n  },\n  \"hallucination\": [\n    {\n      \"position\": <integer>,\n      \"content\": \"<invented object or behavior>\"\n    }\n  ],\n  \"usefulness\": {\n    \"missing_explanations\": [\n      {\n        \"position\": <integer>,\n        \"content\": \"<important concept not explained>\"\n      }\n    ]\n  }\n}\n"
    ],
    "providers": [
      {
        "id": "ollama:gpt-oss:120b",
        "config": {
          "temperature": 0,
          "top_p": 1
        }
      }
    ],
    "tests": [
      {
        "name": "Stage1 Fact Extraction",
        "vars": {
          "source_code": "file://data/JIBSOJHJKNCHK.utf8.SQL",
          "wiki_md": "file://data/JIBSOJHJKNCHK.SQL.md"
        }
      }
    ],
    "scenarios": [],
    "env": {},
    "outputPath": [
      "output/stage1.json"
    ],
    "extensions": [],
    "metadata": {},
    "evaluateOptions": {}
  },
  "shareableUrl": "https://www.promptfoo.app/eval/eval-UAp-2026-01-30T09:47:25",
  "metadata": {
    "promptfooVersion": "0.120.20",
    "nodeVersion": "v22.2.0",
    "platform": "win32",
    "arch": "x64",
    "exportedAt": "2026-01-30T09:47:53.321Z",
    "evaluationCreatedAt": "2026-01-30T09:47:25.405Z",
    "author": "zhangxudong.sun@gmail.com"
  }
}