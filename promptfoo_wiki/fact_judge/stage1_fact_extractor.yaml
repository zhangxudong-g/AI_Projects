providers:
  - id: ollama:gpt-oss:120b
    config:
      temperature: 0
      top_p: 1

prompts:
  - |
    You are a FACT EXTRACTION ENGINE for ENGINEERING WIKI.

    You are given:
    - SOURCE CODE (Java, Python, or SQL/PLSQL)
    - GENERATED WIKI (Markdown)
    - ENGINEERING ANCHORS extracted from source code (classes, methods/functions, tables, packages, procedures, triggers, etc.)

    --- SOURCE CODE ---
    {{source_code}}

    --- GENERATED WIKI ---
    {{wiki_md}}

    --- ENGINEERING ANCHORS ---
    {{engineering_facts}}

    COVERAGE ITEM DEFINITION (VERY IMPORTANT):

    A "coverage item" MUST correspond to a concrete structural element or engineering-level responsibility in the source code.

    Allowed coverage items include ONLY:
    - Class definitions (Java / Python)
    - Method or function definitions (Java / Python)
    - Public fields or properties
    - SQL tables, views, or columns
    - Stored procedures / functions / packages / triggers (SQL / PL/SQL)
    - Explicit control-flow behaviors ONLY IF they are directly implemented in code (transactions, conditional branches, loops)
    - Engineering responsibilities that can be clearly linked to one or more anchors

    Do NOT treat:
    - Explanations, design intent, or usage suggestions
    - High-level concepts without explicit code anchors
    - Implicit behavior inferred from context
    - Summaries, opinions, or subjective judgments

    CRITICAL RULES:
    - Extract ONLY objective, verifiable facts present in the wiki
    - DO NOT evaluate quality
    - DO NOT assign scores
    - DO NOT summarize
    - DO NOT judge usefulness
    - ONLY list concrete missing, mismatched, or hallucinated items
    - Use anchors to justify coverage items
    - Do NOT invent coverage items beyond anchors

    COUNTING RULE:
    - Each coverage item MUST be countable and refer to a specific location or set of anchors in the source code
    - If an item cannot be pointed to a concrete anchor, it MUST NOT be counted

    REQUIRED OUTPUT (VALID JSON ONLY):

    {
      "coverage": {
        "total_items": <integer>,
        "covered_items": <integer>,
        "missing": [
          {
            "position": <integer>,
            "content": "<what is missing>"
          }
        ]
      },
      "correctness": {
        "wrong_count": <integer>,
        "mismatches": [
          {
            "position": <integer>,
            "content": "<what does not match the source>"
          }
        ]
      },
      "hallucination": [
        {
          "position": <integer>,
          "content": "<invented object or behavior>"
        }
      ],
      "usefulness": {
        "missing_explanations": [
          {
            "position": <integer>,
            "content": "<important concept not explained>"
          }
        ]
      }
    }

tests:
  - name: Stage1 Fact Extraction
    # vars:
      # source_code: file://data/agent.py.txt
      # wiki_md: file://data/agent.py.md
    assert:
          - type: contains-json