providers:
  - id: ollama:gpt-oss:120b
    config:
      temperature: 0
      top_p: 1

prompts:
  - |
    You are a STRICT ENGINEERING DOCUMENTATION JUDGE.

    Your task is to evaluate the QUALITY of a GENERATED WIKI
    against VERIFIED ENGINEERING FACTS extracted from source code.

    ============================================================
    INPUT
    ============================================================

    - ENGINEERING FACTS (ground truth, authoritative)
    - GENERATED WIKI (to be judged)
    - ARTIFACT TYPE (VERY IMPORTANT CONTEXT)
    - SOURCE CODE (for reference only, do NOT analyze directly)

    [ENGINEERING FACTS]
    {{facts}}

    [GENERATED WIKI]
    {{wiki_md}}

    [ARTIFACT TYPE]
    {{artifact_type}}

    [SOURCE CODE]
    {{source_code}}

    ---
    ### CRITICAL INTERPRETATION RULES

    1. LOW coverage means "missing explanation", NOT missing input.
    2. Do NOT penalize missing:
       - import statements
       - variable declarations
       - obvious boilerplate or glue code
    3. Grouped or conceptual explanations count as valid coverage.
    4. Design intent, motivation, and workflow explanations are MORE important than listing code elements.

    ---
    ### Correctness Judgment (VERY IMPORTANT)

    Use the following definitions STRICTLY:

    - GOOD:
      The described behaviors are consistent with the source code.

    - MINOR_ISSUES:
      The Wiki is vague, incomplete, or slightly imprecise,
      but DOES NOT describe behavior that contradicts the source code
      and WOULD NOT mislead a developer making changes.

    - BAD:
      Use BAD ONLY IF the Wiki:
      - Explicitly describes behavior that contradicts the source code, OR
      - Claims functionality, side effects, or data flow that does NOT exist, OR
      - Would likely cause a developer to make incorrect modifications.

      Lack of detail, missing explanations, or shallow descriptions
      MUST NOT be marked as BAD.

    ---
    ### Hallucination Judgment

    - NONE:
      No invented components, classes, tables, URLs, or logic.

    - MINOR:
      Minor invented names or examples that do not affect understanding.

    - SEVERE:
      ONLY if the Wiki invents major components, APIs, tables, classes,
      control flows, or system behavior NOT present in the source code.

    If no hallucinated items are listed,
    hallucination_level MUST NOT be SEVERE.

    ---
    ### Coverage Evaluation (Conceptual, NOT enumerative)

    - HIGH:
      All major responsibilities, workflows, and roles are explained.

    - MEDIUM:
      Main workflow is explained, but some behaviors or design intent are unclear.

    - LOW:
      A new developer cannot understand how this file works or why it exists.

    ---
    ### Usefulness Evaluation

    - HIGH:
      A developer can confidently debug, modify, or extend this code.

    - MEDIUM:
      The developer understands the file but would need to inspect the source often.

    - LOW:
      The Wiki provides little help beyond restating obvious facts.

    ---
    ### Output STRICTLY in JSON (no extra text):

    {
      "coverage_level": "HIGH" | "MEDIUM" | "LOW",
      "correctness_level": "GOOD" | "MINOR_ISSUES" | "BAD",
      "hallucination_level": "NONE" | "MINOR" | "SEVERE",
      "usefulness_level": "HIGH" | "MEDIUM" | "LOW",
      "summary": "one concise sentence explaining the overall judgment"
    }



tests:
  - name: Stage2 Soft Judge
    # vars:
    #   facts: file://output/stage1_result.json
    assert:
      - type: contains-json
