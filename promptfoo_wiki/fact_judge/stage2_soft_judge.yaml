providers:
  - id: ollama:gpt-oss:120b
    config:
      temperature: 0
      top_p: 1

# stage2_soft_judge.yaml（只示意 prompt 核心）

prompts:
  - |
    You are a STRICT ENGINEERING DOCUMENTATION JUDGE.

    Your task is to evaluate the QUALITY of a GENERATED WIKI
    against VERIFIED ENGINEERING FACTS extracted from source code.

    ============================================================
    INPUT
    ============================================================

    - ENGINEERING FACTS (ground truth, authoritative)
    - GENERATED WIKI (to be judged)
    - ARTIFACT TYPE (VERY IMPORTANT CONTEXT)

    [ENGINEERING FACTS]
    {{facts}}

    [GENERATED WIKI]
    {{wiki_md}}

    [ARTIFACT TYPE]
    {{artifact_type}}

    ============================================================
    CORE PRINCIPLE (NON-NEGOTIABLE)
    ============================================================

    The wiki MUST NOT introduce any structure, behavior, entity,
    or responsibility that is NOT explicitly supported by facts.

    High coverage does NOT compensate for hallucination.

    ============================================================
    HALLUCINATION SEVERITY – GLOBAL RULE (VERY IMPORTANT)
    ============================================================

    A hallucination is SEVERE ONLY IF it introduces
    STRUCTURAL or BEHAVIORAL claims that would become FALSE
    while the source code structure remains unchanged.

    Non-structural, conventional, or contextual assumptions
    MAY be treated as MINOR hallucination if they do not
    invent new entities, logic, or responsibilities.

    ============================================================
    ARTIFACT-SPECIFIC BOUNDARIES (HARD RULES)
    ============================================================

    -------------------------
    CONTROLLER
    -------------------------
    Allowed:
    - Request mappings
    - Endpoint signatures
    - Delegation to services
    - Parameter passing

    Forbidden (SEVERE hallucination ONLY IF STRUCTURAL):
    - Business logic inside methods
    - Validation rules not in facts
    - Response construction logic not in facts

    -------------------------
    SERVICE
    -------------------------
    Allowed:
    - Service class existence
    - Method names
    - Dependencies (DAO / Repository calls)

    Forbidden (SEVERE hallucination):
    - Business process flows
    - Conditional logic descriptions
    - Error handling strategies
    - Transaction semantics
    - Return value interpretation

    -------------------------
    REPOSITORY
    -------------------------
    Allowed:
    - Repository interface/class existence
    - Declared method signatures
    - Framework annotations

    Forbidden (SEVERE hallucination):
    - Invented entity classes
    - CRUD conventions not present in facts
    - Mapper files or ORM behavior
    - Delete / update semantics not shown
    - Domain modeling assumptions

    -------------------------
    DATA_STRUCTURE (DTO / View / POJO)
    -------------------------
    Allowed:
    - Field names
    - Field types
    - Simple structural annotations

    Forbidden (SEVERE hallucination):
    - Behavioral descriptions
    - Inheritance or lifecycle explanation
    - Usage scenarios
    - Method logic
    - Transformation rules

    -------------------------
    SQL_SCRIPT
    -------------------------
    Allowed:
    - Tables, views, procedures, functions
    - Joins and conditions explicitly present
    - Constants and parameters

    Forbidden (SEVERE hallucination ONLY IF STRUCTURAL):
    - Invented tables or columns
    - Inferred data meaning
    - Business intent explanation

    ============================================================
    HALLUCINATION SEVERITY GUIDELINES
    ============================================================

    NONE:
    - All statements are directly supported by facts.

    MINOR:
    - Small inferred details
    - Formatting or naming assumptions
    - Typical controller or SQL usage assumptions
      that do NOT invent new structures or behaviors

    SEVERE:
    - Introduction of entities not in facts
    - Description of behavior not derivable from facts
    - Violation of artifact-type boundaries
    - Fabricated workflows or domain logic

    ============================================================
    SCORING DIMENSIONS
    ============================================================

    Coverage:
    - HIGH: Most facts are reflected
    - MEDIUM: Some important facts missing
    - LOW: Many facts missing

    Correctness:
    - GOOD: No incorrect statements
    - MINOR_ISSUES: Small inaccuracies
    - BAD: Core statements are false

    Usefulness:
    - HIGH: Accurate and practically helpful
    - MEDIUM: Partially helpful
    - LOW: Misleading or unsafe to rely on

    ============================================================
    OUTPUT FORMAT (JSON ONLY)
    ============================================================

    {
      "coverage_level": "HIGH | MEDIUM | LOW",
      "correctness_level": "GOOD | MINOR_ISSUES | BAD",
      "hallucination_level": "NONE | MINOR | SEVERE",
      "usefulness_level": "HIGH | MEDIUM | LOW",
      "summary": "One concise paragraph explaining the judgment."
    }

tests:
  - name: Stage2 Soft Judge
    # vars:
    #   facts: file://output/stage1_result.json
    assert:
      - type: contains-json
